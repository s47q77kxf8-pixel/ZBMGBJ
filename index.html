<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>美工报价生成器</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- 导航栏 (响应式：移动端在下，桌面端在上) -->
        <nav class="navbar">
            <div class="nav-buttons">
                <button class="nav-btn active" onclick="showPage('calculator')">
                    计算页
                </button>
                <button class="nav-btn" onclick="showPage('quote')">
                    报价页
                </button>
                
                <button class="nav-btn" onclick="showPage('settings')">
                    设置页
                </button>
            </div>
        </nav>

        <!-- 主要内容区域 -->
        <main class="main-content">
            <!-- 计算页 -->
            <div id="calculator" class="page active">
                <div class="section">
                    <h2>单主信息</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="clientId">单主ID</label>
                            <input type="text" id="clientId" placeholder="请输入单主ID">
                        </div>
                        <div class="form-group">
                            <label for="contact">联系方式</label>
                            <div class="contact-input-wrapper">
                                <select id="contactType">
                                    <option value="QQ">QQ</option>
                                    <option value="VX">微信</option>
                                    <option value="MHS">米画师</option>
                                    <option value="RED">小红书</option>
                                    <option value="OTHER">其他</option>
                                </select>
                                <input type="text" id="contact" placeholder="请输入联系方式">
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="startTime">开始时间</label>
                            <input type="date" id="startTime" onchange="calculateDeadline()">
                        </div>
                        <div class="form-group">
                            <label for="deadline">截稿时间</label>
                            <input type="date" id="deadline">
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-title-row d-flex justify-between items-center">
                        <h2>设置选项</h2>
                        <div class="template-fill-wrap">
                            <button type="button" class="btn" id="templateFillBtn" onclick="toggleTemplateFillDropdown()">模版填表</button>
                            <div id="templateFillDropdown" class="template-fill-dropdown d-none">
                                <select id="templateSelect" onchange="onTemplateSelectChange()">
                                    <option value="">-- 选择模板 --</option>
                                </select>
                                <div class="d-flex gap-2 mt-2">
                                    <button type="button" class="btn small" onclick="loadSelectedTemplate(); closeTemplateFillDropdown();">加载</button>
                                    <button type="button" class="btn danger small" id="deleteTemplateBtn" onclick="deleteTemplate();">删除</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 加价类：用途、加急、其他加价类 -->
                    <div class="form-row" id="pricingUpRow">
                        <div class="form-group">
                            <label for="usage">用途</label>
                            <select id="usage"><option value="">--</option></select>
                        </div>
                        <div class="form-group">
                            <label for="urgent">加急</label>
                            <select id="urgent"><option value="">--</option></select>
                        </div>
                    </div>
                    <div id="extraPricingUpSelectsRow" class="form-row d-none">
                        <!-- 动态添加的其他加价类选择器 -->
                    </div>
                    <!-- 折扣类：折扣系数、其他折扣类 -->
                    <div class="form-row" id="pricingDownRow">
                        <div class="form-group">
                            <label for="discount">折扣系数</label>
                            <select id="discount"><option value="">--</option></select>
                        </div>
                    </div>
                    <div id="extraPricingDownSelectsRow" class="form-row d-none">
                        <!-- 动态添加的其他折扣类选择器 -->
                    </div>
                    <!-- 同模、平台费 -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="sameModel">同模系数</label>
                            <select id="sameModel"><option value="">--</option></select>
                        </div>
                        <div class="form-group">
                            <label for="platform">平台手续费</label>
                            <select id="platform"><option value="">--</option></select>
                        </div>
                    </div>
                    <!-- 其他费用：单独一行 -->
                    <div class="form-row">
                        <div class="form-group flex-col gap-2 flex-1">
                            <label for="otherFeesList">其他费用</label>
                            <div class="d-flex gap-2 other-fee-container">
                                <select id="otherFeeType" onchange="updateOtherFeeAmount()" class="flex-1 min-w-0">
                                    <option value="custom">自定义</option>
                                    <!-- 其他费用类别将通过JavaScript动态添加 -->
                                </select>
                                <input type="text" id="customOtherFeeName" placeholder="费用名称" class="flex-1 min-w-0">
                                <input type="number" id="otherFeeAmount" placeholder="金额" min="0" step="1" class="w-80">
                            </div>
                            <div id="dynamicOtherFees" class="mt-2 flex-col gap-2">
                                <!-- 动态添加的其他费用将显示在这里 -->
                            </div>
                            <button class="btn small self-start" onclick="addDynamicOtherFee()">+ 其他费用</button>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>制品信息</h2>
                    <div id="productsContainer">
                        <!-- 制品信息将通过JavaScript动态添加 -->
                    </div>
                    <button class="btn add-product" onclick="addProduct()">+ 制品</button>
                </div>
                
                <div class="section">
                    <h2>赠品信息</h2>
                    <div id="giftsContainer">
                        <!-- 赠品信息将通过JavaScript动态添加 -->
                    </div>
                    <button class="btn add-product" onclick="addGift()">+ 赠品</button>
                </div>
                
                <div class="save-template-row d-flex gap-2 items-center">
                    <!-- 保存按钮放在左侧 -->
                    <button class="btn" onclick="saveTemplate()">保存为模板</button>
                    <!-- 输入框放在右侧 -->
                    <input type="text" id="templateName" placeholder="模板名称">
                </div>
                
                <!-- 计算报价按钮（悬浮球） -->
                <div class="floating-calculate-btn" onclick="calculatePrice()" title="计算报价">
                    报价
                </div>
            </div>

            <!-- 报价页 -->
            <div id="quote" class="page">
                <div class="section">
                    <div class="quote-header d-flex justify-between items-center mb-4">
                        <h2>小票</h2>
                        <div class="quote-actions">
                            <select id="themeSelector" onchange="applyReceiptTheme(this.value)" class="form-control mr-2">
                                <option value="classic">经典</option>
                                <option value="modern">现代</option>
                                <option value="warm">温馨</option>
                                <option value="dark">深色</option>
                                <option value="nature">自然</option>
                                <option value="vintage">复古</option>
                            </select>
                            <button class="btn" onclick="toggleReceiptCustomizationPanel()">小票设置</button>
                            <button class="btn" onclick="saveQuoteAsImage()">保存图片</button>
                            <button class="btn" onclick="saveToHistory()">保存历史</button>
                        </div>
                    </div>
                    <div id="quoteContent" class="quote-content">
                        <!-- 报价内容将通过JavaScript动态生成 -->
                    </div>
                </div>
                
                <!-- 小票设置弹窗（底部弹出） -->
                <div id="receiptCustomizationModal" class="receipt-customization-modal d-none">
                    <div class="receipt-customization-overlay" onclick="closeReceiptCustomizationPanel()"></div>
                    <div class="receipt-customization-content">
                        <div class="receipt-customization-header">
                            <h2>小票设置</h2>
                            <button class="btn-icon" onclick="closeReceiptCustomizationPanel()">×</button>
                        </div>
                        
                        <div class="receipt-customization-body">
                            <div class="receipt-customization-tabs">
                                <button class="tab-btn active" data-tab="settings">设置</button>
                                <button class="tab-btn" data-tab="preview">预览</button>
                            </div>
                            
                            <div class="tab-content active" id="settings-tab">

                                <!-- 小票头部设置 -->
                                <div class="section">
                                    <h3>小票头部</h3>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="receiptHeaderImage">小票头部图片</label>
                                            <input type="file" id="receiptHeaderImage" accept="image/*" onchange="handleReceiptImageUpload('headerImage', this.files[0])" title="推荐尺寸: 宽度不超过300px" style="display: none;">
                                            <button type="button" class="upload-btn" onclick="document.getElementById('receiptHeaderImage').click()">上传图片</button>
                                            <small class="text-gray">推荐尺寸: 宽度不超过300px，高度自适应</small>
                                            <div id="headerImagePreview" class="image-preview"></div>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="receiptTitleText">小票标题</label>
                                            <input type="text" id="receiptTitleText" placeholder="例如：LIST 或 个人作品报价单" onchange="updateReceiptCustomization('titleText', this.value)">
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="receiptOrderNotification">订单通知</label>
                                            <input type="text" id="receiptOrderNotification" placeholder="例如：单主ID，你有一份订单请查收~" onchange="updateReceiptInfo('orderNotification', this.value)">
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <div class="checkbox-row">
                                                <div class="checkbox-item">
                                                    <span>开始时间</span>
                                                    <label class="custom-toggle">
                                                        <input type="checkbox" id="showStartTime" onchange="updateReceiptInfo('showStartTime', this.checked)" checked>
                                                        <span class="toggle-slider"></span>
                                                    </label>
                                                </div>
                                                <div class="checkbox-item">
                                                    <span>截稿时间</span>
                                                    <label class="custom-toggle">
                                                        <input type="checkbox" id="showDeadline" onchange="updateReceiptInfo('showDeadline', this.checked)" checked>
                                                        <span class="toggle-slider"></span>
                                                    </label>
                                                </div>
                                                <div class="checkbox-item">
                                                    <span>设计师</span>
                                                    <label class="custom-toggle">
                                                        <input type="checkbox" id="showDesigner" onchange="updateReceiptInfo('showDesigner', this.checked)" checked>
                                                        <span class="toggle-slider"></span>
                                                    </label>
                                                </div>
                                                <div class="checkbox-item">
                                                    <span>联系方式</span>
                                                    <label class="custom-toggle">
                                                        <input type="checkbox" id="showContactInfo" onchange="updateReceiptInfo('showContactInfo', this.checked)" checked>
                                                        <span class="toggle-slider"></span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="receiptCustomText">自定义文本</label>
                                            <input type="text" id="receiptCustomText" placeholder="输入自定义文本" onchange="updateReceiptInfo('customText', this.value)">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 小票尾部设置 -->
                                <div class="section">
                                    <h3>小票尾部</h3>
                                    <div class="form-row">
                                        <div class="form-group">
                                        <label for="receiptFooterText1">小票尾部图片前文本</label>
                                        <input type="text" id="receiptFooterText1" placeholder="例如：温馨提示" onchange="updateReceiptCustomization('footerText1', this.value)">
                                    </div>
                                    <div class="form-group">
                                        <label for="receiptFooterText2">小票尾部图片后文本</label>
                                        <input type="text" id="receiptFooterText2" placeholder="例如：感谢惠顾" onchange="updateReceiptCustomization('footerText2', this.value)">
                                    </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="receiptFooterImage">小票尾部图片</label>
                                            <input type="file" id="receiptFooterImage" accept="image/*" onchange="handleReceiptImageUpload('footerImage', this.files[0])" title="推荐尺寸: 宽度不超过200px" style="display: none;">
                                            <button type="button" class="upload-btn" onclick="document.getElementById('receiptFooterImage').click()">上传图片</button>
                                            <small class="text-gray">推荐尺寸: 宽度不超过200px，高度自适应</small>
                                            <div id="footerImagePreview" class="image-preview"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="tab-content" id="preview-tab">
                                <div class="section">
                                    <h3>小票预览</h3>
                                    <div class="receipt-preview-container">
                                        <div id="receiptPreview" class="receipt">
                                            <!-- 预览内容将通过JavaScript动态生成 -->
                                        </div>
                                    </div>
                                    <small class="text-gray">预览显示小票的部分内容，实际效果以最终生成为准</small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="receipt-customization-footer">
                            <button class="btn" onclick="clearReceiptCustomization()">清除设置</button>
                            <button class="btn" onclick="closeReceiptCustomizationPanel()">保存设置</button>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>历史记录</h2>
                    <div class="form-row">
                        <div class="form-group w-full">
                            <div class="d-flex gap-2">
                                <input type="text" id="historySearchInput" placeholder="输入关键词搜索历史记录..." class="flex-1" oninput="searchHistory()">
                                <button class="btn" onclick="clearHistorySearch()">清空</button>
                                <button class="btn" id="historyFilterBtn" onclick="toggleHistoryFilterDrawer()">
                                    <span id="historyFilterBtnText">筛选</span>
                                    <span id="historyFilterBadge" class="filter-badge d-none">0</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 筛选抽屉面板（移动端风格） -->
                    <div id="historyFilterDrawer" class="history-filter-drawer">
                        <div class="filter-drawer-overlay" onclick="closeHistoryFilterDrawer()"></div>
                        <div class="filter-drawer-content">
                            <div class="filter-drawer-header">
                                <h3>筛选与排序</h3>
                                <button class="btn-icon" onclick="closeHistoryFilterDrawer()">×</button>
                            </div>
                            <div class="filter-drawer-body">
                                <!-- 时间范围 -->
                                <div class="filter-section">
                                    <label class="filter-label">时间范围</label>
                                    <select id="historyTimeFilter" class="filter-select" onchange="onHistoryFilterChange()">
                                        <option value="all">全部</option>
                                        <option value="today">今天</option>
                                        <option value="week">最近一周</option>
                                        <option value="month">最近一月</option>
                                        <option value="custom">自定义</option>
                                    </select>
                                    <div id="historyCustomDateRange" class="d-none mt-2">
                                        <input type="date" id="historyStartDate" class="filter-input" onchange="onHistoryFilterChange()" placeholder="开始日期">
                                        <span class="mx-2">至</span>
                                        <input type="date" id="historyEndDate" class="filter-input" onchange="onHistoryFilterChange()" placeholder="结束日期">
                                    </div>
                                </div>
                                
                                <!-- 价格范围 -->
                                <div class="filter-section">
                                    <label class="filter-label">价格范围</label>
                                    <div class="d-flex gap-2 items-center">
                                        <input type="number" id="historyMinPrice" class="filter-input flex-1" placeholder="最低价" min="0" step="0.01" onchange="onHistoryFilterChange()">
                                        <span>至</span>
                                        <input type="number" id="historyMaxPrice" class="filter-input flex-1" placeholder="最高价" min="0" step="0.01" onchange="onHistoryFilterChange()">
                                    </div>
                                </div>
                                
                                <!-- 排序 -->
                                <div class="filter-section">
                                    <label class="filter-label">排序方式</label>
                                    <select id="historySortBy" class="filter-select" onchange="onHistoryFilterChange()">
                                        <option value="time-desc">时间（最新）</option>
                                        <option value="time-asc">时间（最早）</option>
                                        <option value="price-desc">价格（高到低）</option>
                                        <option value="price-asc">价格（低到高）</option>
                                        <option value="client-asc">单主ID（A-Z）</option>
                                        <option value="client-desc">单主ID（Z-A）</option>
                                    </select>
                                </div>
                                
                                <!-- 显示方式 -->
                                <div class="filter-section">
                                    <label class="filter-label">显示方式</label>
                                    <select id="historyGroupBy" class="filter-select" onchange="onHistoryFilterChange()">
                                        <option value="none">列表</option>
                                        <option value="month">按月分组</option>
                                    </select>
                                </div>
                                
                                <!-- 批量操作 -->
                                <div class="filter-section">
                                    <label class="filter-label">批量操作</label>
                                    <div class="d-flex gap-2">
                                        <button class="btn secondary flex-1" onclick="selectAllHistory()">全选</button>
                                        <button class="btn danger flex-1" id="batchDeleteBtn" onclick="batchDeleteHistory()" disabled>批量删除</button>
                                    </div>
                                </div>
                                
                                <!-- 导出 -->
                                <div class="filter-section">
                                    <button class="btn w-full" onclick="exportHistoryToExcel(); closeHistoryFilterDrawer();">导出Excel</button>
                                </div>
                            </div>
                            <div class="filter-drawer-footer">
                                <button class="btn secondary flex-1" onclick="resetHistoryFilters()">重置</button>
                                <button class="btn flex-1" onclick="applyHistoryFilters(); closeHistoryFilterDrawer();">应用</button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="historyContainer" class="history-container">
                        <!-- 历史记录将通过JavaScript动态生成 -->
                    </div>
                </div>
            </div>

            <!-- 设置页 -->
            <div id="settings" class="page">
                <!-- 美工信息 -->
                <div class="section">
                    <h2>美工信息</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="artistId">美工ID</label>
                            <input type="text" id="artistId" placeholder="请输入美工ID" onchange="updateArtistInfo('id', this.value)">
                        </div>
                        <div class="form-group">
                            <label for="artistContact">联系方式</label>
                            <input type="text" id="artistContact" placeholder="请输入联系方式" onchange="updateArtistInfo('contact', this.value)">
                        </div>
                        <div class="form-group">
                            <label for="defaultDuration">默认工期（天）</label>
                            <input type="number" id="defaultDuration" placeholder="请输入默认工期" min="0" step="1" onchange="updateArtistInfo('defaultDuration', this.value)">
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="d-flex justify-between items-center mb-4 flex-wrap gap-2">
                        <h2>制品设置</h2>
                        <div class="d-flex items-center gap-2">
                            <button class="btn add-product-setting btn-compact" onclick="openAddProductModal()">添加</button>
                            <button class="btn secondary btn-compact" onclick="document.getElementById('excelImportInput').click()">导入</button>
                            <button class="btn secondary btn-compact" onclick="exportToExcel()">导出</button>
                            <input type="file" id="excelImportInput" accept=".xlsx,.xls" class="d-none" onchange="importFromExcel(event)">
                        </div>
                    </div>
                    <div id="productSettingsContainer">
                    <!-- 制品设置将通过JavaScript动态添加 -->
                    </div>
                
                    <!-- 添加制品弹窗 -->
                    <div id="addProductModal" class="modal d-none">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h3>添加制品设置</h3>
                                <span class="close" onclick="closeAddProductModal()">&times;</span>
                            </div>
                            <div class="modal-body">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>分类</label>
                                        <div id="newProductCategorySelect"></div>
                                    </div>
                                    <div class="form-group">
                                        <label>制品名称</label>
                                        <input type="text" id="newProductName" placeholder="请输入制品名称">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>计价方式</label>
                                        <select id="newProductPriceType">
                                            <option value="fixed">固定价</option>
                                            <option value="double">单双面价</option>
                                            <option value="config">基础+递增价</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <!-- 固定价设置 -->
                                <div id="fixedPriceSettings" class="price-settings">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>固定价格</label>
                                            <input type="number" id="newProductPrice" placeholder="请输入固定价格" min="0" step="1">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 单双面价设置 -->
                                <div id="doublePriceSettings" class="price-settings d-none">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>单面价格</label>
                                            <input type="number" id="newProductPriceSingle" placeholder="请输入单面价格" min="0" step="1">
                                        </div>
                                        <div class="form-group">
                                            <label>双面价格</label>
                                            <input type="number" id="newProductPriceDouble" placeholder="请输入双面价格" min="0" step="1">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 基础+递增价设置 -->
                                <div id="configPriceSettings" class="price-settings d-none">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>基础配置</label>
                                            <input type="text" id="newProductBaseConfig" placeholder="例如：立牌+底座">
                                        </div>
                                        <div class="form-group">
                                            <label>基础价</label>
                                            <input type="number" id="newProductBasePrice" placeholder="请输入基础价" min="0" step="1">
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group flex-1">
                                            <label>递增配置项</label>
                                            <div id="additionalConfigsContainer"></div>
                                            <button type="button" class="btn secondary mt-2" onclick="addAdditionalConfig()">+ 配置项</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button class="btn" onclick="saveNewProduct()">保存</button>
                                <button class="btn secondary" onclick="closeAddProductModal()">取消</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="d-flex justify-between items-center mb-4 flex-wrap gap-2">
                        <h2>系数设置</h2>
                        <div class="d-flex items-center gap-2">
                            <button class="btn add-product-setting btn-compact" onclick="openAddCoefficientModal()">添加</button>
                            <button class="btn secondary btn-compact" onclick="document.getElementById('coefficientExcelImportInput').click()">导入</button>
                            <button class="btn secondary btn-compact" onclick="exportCoefficientsToExcel()">导出</button>
                            <input type="file" id="coefficientExcelImportInput" accept=".xlsx,.xls" class="d-none" onchange="importCoefficientsFromExcel(event)">
                        </div>
                    </div>

                    <!-- 加价类：用途系数、加急系数，可添加其他 -->
                    <h3 class="coefficient-class-title">加价类</h3>
                    <!-- 用途系数 -->
                    <div class="category-container">
                        <div class="category-header" onclick="toggleCategory('usageCoefficient')">
                            <div class="category-title">用途系数</div>
                            <div class="category-toggle">▼</div>
                        </div>
                        <div class="category-content d-none" id="usageCoefficient-content">
                            <div class="form-row">
                                <div class="form-group">
                                    <div class="coefficient-settings" id="usageCoefficientSettings">
                                        <!-- 用途系数将通过JavaScript动态生成 -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 加急系数 -->
                    <div class="category-container">
                        <div class="category-header" onclick="toggleCategory('urgentCoefficient')">
                            <div class="category-title">加急系数</div>
                            <div class="category-toggle">▼</div>
                        </div>
                        <div class="category-content d-none" id="urgentCoefficient-content">
                            <div class="form-row">
                                <div class="form-group">
                                    <div class="coefficient-settings">
                                        <!-- 加急系数将通过JavaScript动态生成 -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="extraPricingUpContainer"></div>
                    
                    <!-- 折扣类：折扣系数，可添加其他 -->
                    <h3 class="coefficient-class-title">折扣类</h3>
                    <!-- 折扣系数 -->
                    <div class="category-container">
                        <div class="category-header" onclick="toggleCategory('discountCoefficient')">
                            <div class="category-title">折扣系数</div>
                            <div class="category-toggle">▼</div>
                        </div>
                        <div class="category-content d-none" id="discountCoefficient-content">
                            <div class="form-row">
                                <div class="form-group">
                                    <div class="coefficient-settings">
                                        <!-- 折扣系数将通过JavaScript动态生成 -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="extraPricingDownContainer"></div>
                    
                    <!-- 其他类：同模系数、平台手续费、其他费用 -->
                    <h3 class="coefficient-class-title">其他类</h3>
                    <!-- 同模系数 -->
                    <div class="category-container">
                        <div class="category-header" onclick="toggleCategory('sameModelCoefficient')">
                            <div class="category-title">同模系数</div>
                            <div class="category-toggle">▼</div>
                        </div>
                        <div class="category-content d-none" id="sameModelCoefficient-content">
                            <div class="form-row">
                                <div class="form-group">
                                    <div class="coefficient-settings">
                                        <!-- 同模系数将通过JavaScript动态生成 -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 平台手续费 -->
                    <div class="category-container">
                        <div class="category-header" onclick="toggleCategory('platformFee')">
                            <div class="category-title">平台手续费</div>
                            <div class="category-toggle">▼</div>
                        </div>
                        <div class="category-content d-none" id="platformFee-content">
                            <div class="form-row">
                                <div class="form-group">
                                    <div class="coefficient-settings">
                                        <!-- 平台手续费将通过JavaScript动态生成 -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 背景费设置 -->
                    <div class="category-container">
                        <div class="category-header" onclick="toggleCategory('backgroundFee')">
                            <div class="category-title">背景费</div>
                            <div class="category-toggle">▼</div>
                        </div>
                        <div class="category-content d-none" id="backgroundFee-content">
                            <div class="form-row">
                                <div class="form-group">
                                    <div class="coefficient-settings">
                                        <div class="mb-2 d-flex items-center gap-2">
                                            <input type="text" value="背景费" class="flex-1" readonly>
                                            <input type="number" id="backgroundFeeInput" min="0" step="1" class="w-80" 
                                                   onchange="updateBackgroundFee(this.value)">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 其他费用 -->
                    <div class="category-container">
                        <div class="category-header" onclick="toggleCategory('otherFees')">
                            <div class="category-title">其他费用</div>
                            <div class="category-toggle">▼</div>
                        </div>
                        <div class="category-content d-none" id="otherFees-content">
                            
                            <!-- 其他费用类别 -->
                            <div class="form-row mt-4">
                                <div class="form-group flex-1">
                                    <label>其他费用类别</label>
                                    <div class="d-flex gap-2 mt-2 flex-wrap">
                                        <input type="text" id="newOtherFeeName" placeholder="费用名称" class="flex-1 min-w-0">
                                        <input type="number" id="newOtherFeeAmount" placeholder="金额" min="0" step="1" class="w-80">
                                        <button class="btn btn-compact" onclick="addOtherFee()">添加</button>
                                    </div>
                                </div>
                            </div>
                            <!-- 其他费用列表 -->
                            <div id="otherFeesList" class="other-fees-list mt-4 ml-4">
                                <!-- 其他费用列表将通过JavaScript动态生成 -->
                            </div>
                        </div>
                    </div>

                </div>

                <!-- 工艺设置 -->
                <div class="section">
                    <div class="category-container">
                        <div class="category-header" onclick="toggleCategory('process')">
                            <div class="category-title">工艺设置</div>
                            <div class="category-actions">
                                <button class="btn add-process-setting btn-compact" onclick="openAddProcessModal()">添加</button>
                                <div class="category-toggle">▼</div>
                            </div>
                        </div>
                        <div class="category-content d-none" id="process-content">
                            <div id="processSettingsContainer">
                                <!-- 工艺设置将通过JavaScript动态添加 -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 添加系数弹窗 -->
                <div id="addCoefficientModal" class="modal d-none">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>添加系数</h3>
                            <span class="close" onclick="closeAddCoefficientModal()">&times;</span>
                        </div>
                        <div class="modal-body">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="coefficientCategory">系数大类</label>
                                    <select id="coefficientCategory" onchange="updateCoefficientSubType()">
                                        <option value="pricingUp">加价类</option>
                                        <option value="pricingDown">折扣类</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>系数小类</label>
                                    <div id="coefficientTypeSelect"></div>
                                    <small id="coefficientTypeHint">根据上方选择的大类输入系数名称</small>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>系数值项</label>
                                    <div id="coefficientItemsContainer" style="display: flex; flex-direction: column; gap: 0.5rem;">
                                        <!-- 系数值项将通过JavaScript动态添加 -->
                                    </div>
                                    <button type="button" class="btn secondary mt-2" onclick="addCoefficientItem()">+ 系数值</button>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn" onclick="saveNewCoefficient()">保存</button>
                            <button class="btn secondary" onclick="closeAddCoefficientModal()">取消</button>
                        </div>
                    </div>
                </div>
                
                <!-- 添加工艺设置弹窗 -->
                <div id="addProcessModal" class="modal d-none">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>添加工艺设置</h3>
                            <span class="close" onclick="closeAddProcessModal()">&times;</span>
                        </div>
                        <div class="modal-body">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="newProcessName">工艺名称</label>
                                    <input type="text" id="newProcessName" placeholder="请输入工艺名称">
                                </div>
                                <div class="form-group">
                                    <label for="newProcessPrice">价格（每层）</label>
                                    <input type="number" id="newProcessPrice" min="0" step="1">
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn" onclick="saveNewProcess()">保存</button>
                            <button class="btn secondary" onclick="closeAddProcessModal()">取消</button>
                        </div>
                    </div>
                </div>
                
                
                
                <div class="d-flex gap-2">
                    <button class="btn save-settings" onclick="saveSettings()">保存设置</button>
                    <button class="btn secondary" onclick="resetToDefaultSettings()">恢复默认设置</button>
                </div>
            </div>
            

        </main>
    </div>

    <script src="script.js"></script>
</body>
</html>
