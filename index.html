<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metton · 接单助手</title>
    <script>
    (function(){var t=localStorage.getItem('appTheme');var d=typeof matchMedia!='undefined'&&matchMedia('(prefers-color-scheme: dark)').matches;var e=(t==='light'||t==='dark')?t:(d?'dark':'light');if(e==='dark')document.documentElement.classList.add('theme-dark');})();
    </script>
    <link rel="stylesheet" href="style.css?v=20250131-process-input">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <!-- SVG 图标库：扁平化（非 emoji），使用 currentColor 继承按钮颜色 -->
    <svg aria-hidden="true" focusable="false" style="position:absolute;width:0;height:0;overflow:hidden">
        <!-- 线性图标（描边） -->
        <symbol id="i-close" viewBox="0 0 24 24">
            <path d="M6 6l12 12M18 6L6 18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <symbol id="i-settings" viewBox="0 0 24 24">
            <path d="M12 15.2a3.2 3.2 0 1 0 0-6.4 3.2 3.2 0 0 0 0 6.4Z" fill="none" stroke="currentColor" stroke-width="2"/>
            <path d="M19.4 15a8.9 8.9 0 0 0 .1-6l-2 .3a7.2 7.2 0 0 0-1.1-1.9l1.2-1.6a8.9 8.9 0 0 0-5.2-2.2l-.4 2a7.2 7.2 0 0 0-2.2 0l-.4-2A8.9 8.9 0 0 0 4.2 5.8l1.2 1.6a7.2 7.2 0 0 0-1.1 1.9l-2-.3a8.9 8.9 0 0 0 .1 6l2-.3c.3.7.7 1.3 1.1 1.9l-1.2 1.6a8.9 8.9 0 0 0 5.2 2.2l.4-2c.7.1 1.5.1 2.2 0l.4 2a8.9 8.9 0 0 0 5.2-2.2l-1.2-1.6c.5-.6.9-1.2 1.1-1.9l2 .3Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
        </symbol>
        <symbol id="i-filter" viewBox="0 0 24 24">
            <path d="M4 6h16M7 12h10M10 18h4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <symbol id="i-search" viewBox="0 0 24 24">
            <path d="M11 18a7 7 0 1 1 0-14 7 7 0 0 1 0 14Z" fill="none" stroke="currentColor" stroke-width="2"/>
            <path d="M20 20l-3.5-3.5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <symbol id="i-trash" viewBox="0 0 24 24">
            <path d="M9 4h6l1 2h4M5 6h14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M8 6l1 14h6l1-14" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M10 11v6M14 11v6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <!-- 删除图标选项 -->
        <symbol id="i-trash-simple" viewBox="0 0 24 24">
            <path d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2m3 0v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6h14Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M10 11v6M14 11v6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <symbol id="i-minus-circle" viewBox="0 0 24 24">
            <path d="M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20Z" fill="none" stroke="currentColor" stroke-width="2"/>
            <path d="M8 12h8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <symbol id="i-prohibit" viewBox="0 0 24 24">
            <path d="M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20Z" fill="none" stroke="currentColor" stroke-width="2"/>
            <path d="M8 8l8 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <symbol id="i-x-circle" viewBox="0 0 24 24">
            <path d="M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20Z" fill="none" stroke="currentColor" stroke-width="2"/>
            <path d="M9 9l6 6M15 9l-6 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <!-- 结单/完成：圆圈对勾（推荐用于结单） -->
        <symbol id="i-check-circle" viewBox="0 0 24 24">
            <path d="M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20Z" fill="none" stroke="currentColor" stroke-width="2"/>
            <path d="M8 12l3 3 5-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </symbol>
        <symbol id="i-export" viewBox="0 0 24 24">
            <path d="M12 3v12" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M8 7l4-4 4 4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M5 14v5h14v-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
        </symbol>
        <symbol id="i-import" viewBox="0 0 24 24">
            <path d="M12 21v-12" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M8 17l4 4 4-4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M5 10V5h14v5" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
        </symbol>
        <symbol id="i-back" viewBox="0 0 24 24">
            <path d="M15 6l-6 6 6 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </symbol>
        <symbol id="i-sort-desc" viewBox="0 0 24 24">
            <path d="M6 8h12M6 12h8M6 16h4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M16 14l2 2 2-2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </symbol>
        <!-- 返回今日图标备选（与页面返回 i-back 区分） -->
        <symbol id="i-today-curved" viewBox="0 0 24 24"><path d="M3 12a9 9 0 1 0 9-9 7.5 7.5 0 0 0-2 0" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M3 12v7h7" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></symbol>
        <symbol id="i-today-calendar-dot" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" fill="none" stroke="currentColor" stroke-width="2"/><path d="M16 2v4M8 2v4M3 10h18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><circle cx="12" cy="16" r="2" fill="currentColor"/></symbol>
        <symbol id="i-today-crosshair" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/><path d="M12 2v4M12 18v4M2 12h4M18 12h4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><circle cx="12" cy="12" r="2" fill="currentColor"/></symbol>
        <symbol id="i-today-skip-start" viewBox="0 0 24 24"><path d="M5 5v14M5 12l10-4v8L5 12z" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></symbol>
        <!-- 弯箭头风格但不似刷新：弧线指向一点 -->
        <symbol id="i-today-arc-point" viewBox="0 0 24 24"><path d="M18 6A8 8 0 0 0 6 14v4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M6 18l4-4-4-4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></symbol>
        <symbol id="i-today-hook" viewBox="0 0 24 24"><path d="M18 8c-4-2-8 2-8 6v4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M10 18l-4-4 4-4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></symbol>
        <symbol id="i-today-corner" viewBox="0 0 24 24"><path d="M18 6v8a4 4 0 0 1-4 4H6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M6 18l4-4-4-4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></symbol>
        <symbol id="i-sun" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="4" fill="none" stroke="currentColor" stroke-width="2"/>
            <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <symbol id="i-moon" viewBox="0 0 24 24">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" fill="none" stroke="currentColor" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"/>
        </symbol>
        <symbol id="i-image" viewBox="0 0 24 24">
            <path d="M4 6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6Z" fill="none" stroke="currentColor" stroke-width="2"/>
            <path d="M8.5 10.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z" fill="none" stroke="currentColor" stroke-width="2"/>
            <path d="M4 16l5-5 4 4 3-3 4 4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </symbol>
        <!-- 小票右上角图标·线性备选：设置 -->
        <symbol id="i-settings-line-a" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="2.5" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <path d="M12 4v1.5M12 18.5V20M4 12h1.5M18.5 12H20M6.34 6.34l1.06 1.06M16.6 16.6l1.06 1.06M6.34 17.66l1.06-1.06M16.6 7.4l1.06-1.06" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <path d="M19.4 15a8.9 8.9 0 0 0 .1-6l-2 .3a7.2 7.2 0 0 0-1.1-1.9l1.2-1.6a8.9 8.9 0 0 0-5.2-2.2l-.4 2a7.2 7.2 0 0 0-2.2 0l-.4-2A8.9 8.9 0 0 0 4.2 5.8l1.2 1.6a7.2 7.2 0 0 0-1.1 1.9l-2-.3a8.9 8.9 0 0 0 .1 6l2-.3c.3.7.7 1.3 1.1 1.9l-1.2 1.6a8.9 8.9 0 0 0 5.2 2.2l.4-2c.7.1 1.5.1 2.2 0l.4 2a8.9 8.9 0 0 0 5.2-2.2l-1.2-1.6c.5-.6.9-1.2 1.1-1.9l2 .3Z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>
        </symbol>
        <symbol id="i-settings-line-b" viewBox="0 0 24 24">
            <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <path d="M19.4 15a8.9 8.9 0 0 0 .1-6l-2 .3a7.2 7.2 0 0 0-1.1-1.9l1.2-1.6a8.9 8.9 0 0 0-5.2-2.2l-.4 2a7.2 7.2 0 0 0-2.2 0l-.4-2A8.9 8.9 0 0 0 4.2 5.8l1.2 1.6a7.2 7.2 0 0 0-1.1 1.9l-2-.3a8.9 8.9 0 0 0 .1 6l2-.3c.3.7.7 1.3 1.1 1.9l-1.2 1.6a8.9 8.9 0 0 0 5.2 2.2l.4-2c.7.1 1.5.1 2.2 0l.4 2a8.9 8.9 0 0 0 5.2-2.2l-1.2-1.6c.5-.6.9-1.2 1.1-1.9l2 .3Z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>
        </symbol>
        <symbol id="i-settings-line-c" viewBox="0 0 24 24">
            <path d="M4 7h10M4 12h14M4 17h8" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <circle cx="17" cy="7" r="1.5" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="19" cy="12" r="1.5" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="15" cy="17" r="1.5" fill="none" stroke="currentColor" stroke-width="1.5"/>
        </symbol>
        <!-- C 同系：滑块类新方案 -->
        <symbol id="i-settings-line-c1" viewBox="0 0 24 24">
            <path d="M4 7h12M4 12h14M4 17h10" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <circle cx="18" cy="7" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="18" cy="12" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="18" cy="17" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
        </symbol>
        <symbol id="i-settings-line-c2" viewBox="0 0 24 24">
            <path d="M4 8h16M4 12h16M4 16h16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </symbol>
        <symbol id="i-settings-line-c3" viewBox="0 0 24 24">
            <path d="M4 6h16M4 12h16M4 18h16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <circle cx="8" cy="6" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="12" cy="12" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="16" cy="18" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
        </symbol>
        <!-- C3 优化变体 -->
        <symbol id="i-settings-line-c3a" viewBox="0 0 24 24">
            <path d="M5 6.5h14M5 12h14M5 17.5h14" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <circle cx="8" cy="6.5" r="1.1" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="12" cy="12" r="1.1" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="16" cy="17.5" r="1.1" fill="none" stroke="currentColor" stroke-width="1.5"/>
        </symbol>
        <symbol id="i-settings-line-c3b" viewBox="0 0 24 24">
            <path d="M4 6h16M4 12h16M4 18h16" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round"/>
            <circle cx="7" cy="6" r="1.15" fill="none" stroke="currentColor" stroke-width="1.4"/>
            <circle cx="12" cy="12" r="1.15" fill="none" stroke="currentColor" stroke-width="1.4"/>
            <circle cx="17" cy="18" r="1.15" fill="none" stroke="currentColor" stroke-width="1.4"/>
        </symbol>
        <!-- C3 长线变体 -->
        <symbol id="i-settings-line-c3-l1" viewBox="0 0 24 24">
            <path d="M3 6h18M3 12h18M3 18h18" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <circle cx="7.5" cy="6" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="12" cy="12" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="16.5" cy="18" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
        </symbol>
        <symbol id="i-settings-line-c3-l2" viewBox="0 0 24 24">
            <path d="M2 6h20M2 12h20M2 18h20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <circle cx="8" cy="6" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="12" cy="12" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="17" cy="18" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
        </symbol>
        <symbol id="i-settings-line-c3-l3" viewBox="0 0 24 24">
            <path d="M2 6h20M2 12h20M2 18h20" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <circle cx="7" cy="6" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="12" cy="12" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="18" cy="18" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
        </symbol>
        <symbol id="i-settings-line-c3-l4" viewBox="0 0 24 24">
            <path d="M1 6h22M1 12h22M1 18h22" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <circle cx="7" cy="6" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="12" cy="12" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="18" cy="18" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
        </symbol>
        <symbol id="i-settings-line-c4" viewBox="0 0 24 24">
            <path d="M4 6.5h10M4 10h12M4 13.5h11M4 17h9" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <circle cx="17" cy="6.5" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="18" cy="10" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="17.5" cy="13.5" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="16" cy="17" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
        </symbol>
        <symbol id="i-settings-line-c5" viewBox="0 0 24 24">
            <path d="M5 7h8M5 12h12M5 17h10" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <circle cx="16" cy="7" r="1.3" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="19" cy="12" r="1.3" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="17" cy="17" r="1.3" fill="none" stroke="currentColor" stroke-width="1.5"/>
        </symbol>
        <symbol id="i-settings-line-d" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="3" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <path d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </symbol>
        <symbol id="i-settings-line-e" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="2.5" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="12" cy="5" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="12" cy="19" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="5" cy="12" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="19" cy="12" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="7.2" cy="7.2" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="16.8" cy="7.2" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="7.2" cy="16.8" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="16.8" cy="16.8" r="1.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
        </symbol>
        <symbol id="i-settings-line-f" viewBox="0 0 24 24">
            <path d="M12 8v1.5M12 14.5V16M8 12h-1.5M15.5 12H17M9.88 9.88l-1.06 1.06M15.18 15.18l-1.06 1.06M9.88 14.12l-1.06-1.06M15.18 8.82l-1.06-1.06" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <circle cx="12" cy="12" r="2.5" fill="none" stroke="currentColor" stroke-width="1.5"/>
        </symbol>
        <!-- 齿轮类·其他线性风格 -->
        <symbol id="i-settings-line-g" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="2.5" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <path d="M12 12L17.2 12M12 12L15.9 15.9M12 12L12 17.2M12 12L8.1 15.9M12 12L6.8 12M12 12L8.1 8.1M12 12L12 6.8M12 12L15.9 8.1" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </symbol>
        <symbol id="i-settings-line-h" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="5" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="12" cy="12" r="2.5" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <path d="M12 12L17 12M12 12L15.5 15.5M12 12L12 17M12 12L8.5 15.5M12 12L7 12M12 12L8.5 8.5M12 12L12 7M12 12L15.5 8.5" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </symbol>
        <symbol id="i-settings-line-i" viewBox="0 0 24 24">
            <path d="M12 4.2v2.2M12 17.6v2.2M4.2 12h2.2M17.6 12h2.2M6.4 6.4l1.55 1.55M16.05 16.05l1.55 1.55M6.4 17.6l1.55-1.55M16.05 7.95l1.55-1.55" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <circle cx="12" cy="12" r="3.8" fill="none" stroke="currentColor" stroke-width="1.5"/>
        </symbol>
        <symbol id="i-settings-line-j" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="4.2" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <path d="M12 6.2v1.6M12 16.2v1.6M6.2 12h1.6M16.2 12h1.6M8.3 8.3l1.15 1.15M14.55 14.55l1.15 1.15M8.3 15.7l1.15-1.15M14.55 9.45l1.15-1.15" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </symbol>
        <symbol id="i-settings-line-k" viewBox="0 0 24 24">
            <path d="M12 3v2.5M12 18.5V21M3 12h2.5M18.5 12H21M6.2 6.2l1.75 1.75M16.05 16.05l1.75 1.75M6.2 17.8l1.75-1.75M16.05 7.95l1.75-1.75" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <circle cx="12" cy="12" r="4.5" fill="none" stroke="currentColor" stroke-width="1.5"/>
        </symbol>
        <!-- 设置图标·新一批（非齿轮） -->
        <symbol id="i-settings-line-l" viewBox="0 0 24 24">
            <path d="M12 3v3M12 18v3M3 12h3M18 12h3M7.05 7.05l2.12 2.12M14.83 14.83l2.12 2.12M7.05 16.95l2.12-2.12M14.83 9.17l2.12-2.12" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <circle cx="12" cy="12" r="2.5" fill="none" stroke="currentColor" stroke-width="1.5"/>
        </symbol>
        <symbol id="i-settings-line-m" viewBox="0 0 24 24">
            <path d="M8 6v12M12 9v9M16 4v14" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </symbol>
        <symbol id="i-settings-line-n" viewBox="0 0 24 24">
            <circle cx="12" cy="6" r="1.5" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="12" cy="12" r="1.5" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="12" cy="18" r="1.5" fill="none" stroke="currentColor" stroke-width="1.5"/>
        </symbol>
        <symbol id="i-settings-line-o" viewBox="0 0 24 24">
            <path d="M7 8v8M12 4v16M17 10v4" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </symbol>
        <symbol id="i-settings-line-p" viewBox="0 0 24 24">
            <rect x="4" y="4" width="6" height="6" rx="1" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <rect x="14" y="4" width="6" height="6" rx="1" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <rect x="4" y="14" width="6" height="6" rx="1" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <rect x="14" y="14" width="6" height="6" rx="1" fill="none" stroke="currentColor" stroke-width="1.5"/>
        </symbol>
        <!-- 小票右上角图标·线性备选：存图 -->
        <symbol id="i-image-line-a" viewBox="0 0 24 24">
            <rect x="3" y="5" width="18" height="14" rx="1" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="8.5" cy="9.5" r="1.5" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <path d="M3 15l4-3 3 2 5-4 4 3" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </symbol>
        <symbol id="i-image-line-b" viewBox="0 0 24 24">
            <rect x="2" y="4" width="20" height="16" rx="1.5" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="9" cy="9" r="2" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <path d="M2 17l5-4 4 3 6-5 5 4" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </symbol>
        <symbol id="i-image-line-c" viewBox="0 0 24 24">
            <path d="M5 4h14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2Z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>
            <circle cx="9" cy="9" r="1.8" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <path d="M5 16l3.5-2.5 3 2 4-3 4.5 3.5" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </symbol>
        <symbol id="i-edit" viewBox="0 0 24 24">
            <path d="M4 20h4l10.5-10.5a2.1 2.1 0 0 0 0-3L16.5 4.5a2.1 2.1 0 0 0-3 0L3 15v5Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M12.5 5.5l6 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <symbol id="i-plus" viewBox="0 0 24 24">
            <path d="M12 5v14M5 12h14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <symbol id="i-note" viewBox="0 0 24 24">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6Z" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>
            <path d="M14 2v6h6M8 13h8M8 17h5" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </symbol>
        <!-- 小票图标（与保存按钮同比例 24×24 stroke 2，可替换 href 切换） -->
        <!-- ① 横条+竖线（当前） -->
        <symbol id="i-receipt" viewBox="0 0 24 24">
            <path d="M2 9h20v6H2V9Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M8 9v6M14 9v6M18 9v3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <!-- ② 纸条+横线（经典小票） -->
        <symbol id="i-receipt-list" viewBox="0 0 24 24">
            <path d="M6 4h12a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M8 9h8M8 13h8M8 17h5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <!-- ③ 横条（极简） -->
        <symbol id="i-receipt-strip" viewBox="0 0 24 24">
            <path d="M3 10h18v4H3V10Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
        </symbol>
        <!-- ④ 双横条（叠票） -->
        <symbol id="i-receipt-double" viewBox="0 0 24 24">
            <path d="M4 7h16v3H4V7Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M4 14h16v3H4v-3Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
        </symbol>
        <!-- ⑤ 方纸+横线 -->
        <symbol id="i-receipt-roll" viewBox="0 0 24 24">
            <path d="M5 5h14v14H5V5Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M8 9h8M8 12h8M8 15h5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <!-- ⑥ 三横线（清单） -->
        <symbol id="i-receipt-lines" viewBox="0 0 24 24">
            <path d="M6 7h12M6 12h12M6 17h8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <!-- ⑦ 竖条+横线（热敏条） -->
        <symbol id="i-receipt-tape" viewBox="0 0 24 24">
            <path d="M9 4h6v16H9V4Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M7 8h10M7 12h10M7 16h6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <!-- ⑧ 撕边横条 -->
        <symbol id="i-receipt-tear" viewBox="0 0 24 24">
            <path d="M3 9h18v2.5c0 .5-1.5 2.5-3 2.5s-3-2-4.5-2-2.5 2-4.5 2S5 11.5 5 11V9Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
        </symbol>
        <!-- ⑨ 圆角条+横线 -->
        <symbol id="i-receipt-round" viewBox="0 0 24 24">
            <path d="M6 6h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M8 11h8M8 14h6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <!-- ⑩ 票据角（折角） -->
        <symbol id="i-receipt-fold" viewBox="0 0 24 24">
            <path d="M5 5h11l5 5v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M16 5v5h5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <!-- ⑪～⑮ 更多小票 -->
        <symbol id="i-receipt-curl" viewBox="0 0 24 24">
            <path d="M4 10h16v1.5c0 .8-2 2.5-4 2.5s-4-1.7-6-2.5-2 .5-4 .5-2-1-2-1.5V10Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
        </symbol>
        <symbol id="i-receipt-dash" viewBox="0 0 24 24">
            <path d="M5 9h2M9 9h2M13 9h2M17 9h2M5 13h2M9 13h6M5 17h8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <symbol id="i-receipt-narrow" viewBox="0 0 24 24">
            <path d="M10 5h4v14h-4V5Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M8 9h8M8 13h8M8 17h5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <symbol id="i-receipt-triple" viewBox="0 0 24 24">
            <path d="M4 6h16v2.5H4V6Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M4 11h16v2.5H4V11Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M4 16h16v2.5H4V16Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
        </symbol>
        <symbol id="i-receipt-belt" viewBox="0 0 24 24">
            <path d="M3 11h18v2H3v-2Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M6 8v8M10 8v8M14 8v8M18 8v8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <symbol id="i-overwrite" viewBox="0 0 24 24">
            <path d="M4 4h12l4 4v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M8 12l3 3 5-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </symbol>
        <!-- 保存图标备选（与小票同比例 24×24 stroke 2） -->
        <symbol id="i-save-disk" viewBox="0 0 24 24">
            <path d="M6 4h10l2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M8 12h8M8 16h8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <symbol id="i-save-check" viewBox="0 0 24 24">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M14 2v6h6M9 15l2 2 4-4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </symbol>
        <symbol id="i-save-down" viewBox="0 0 24 24">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M14 2v6h6M12 11v6M9 14l3 3 3-3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </symbol>
        <symbol id="i-save-folder" viewBox="0 0 24 24">
            <path d="M4 4h6l2 2h8a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M12 12v6M9 15l3-3 3 3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </symbol>
        <symbol id="i-save-bookmark" viewBox="0 0 24 24">
            <path d="M6 4h12v16l-6-4-6 4V4Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
        </symbol>
        <symbol id="i-save-archive" viewBox="0 0 24 24">
            <path d="M4 6h16v2H4V6Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M4 6v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M8 12h8M8 16h8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <symbol id="i-save-clipboard" viewBox="0 0 24 24">
            <path d="M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-2" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M8 2h8v4H8V2Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M8 13h8M8 17h5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <symbol id="i-save-pin" viewBox="0 0 24 24">
            <path d="M12 2v6l4 4v8h-2v-6h-4v6H8v-8l4-4V2Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
        </symbol>
        <symbol id="i-save-copy" viewBox="0 0 24 24">
            <path d="M8 4H6a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M8 4a2 2 0 0 1 2-2h8v4a2 2 0 0 1 2 2v8" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
        </symbol>
        <!-- ⑪～⑮ 更多保存 -->
        <symbol id="i-save-floppy" viewBox="0 0 24 24">
            <path d="M6 2h8l4 4v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M8 2v6h8V2M8 14h8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <symbol id="i-save-circle-check" viewBox="0 0 24 24">
            <path d="M12 4a8 8 0 1 1 0 16 8 8 0 0 1 0-16Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M9 12l2 2 4-4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </symbol>
        <symbol id="i-save-inbox" viewBox="0 0 24 24">
            <path d="M6 4h12v6l-3 4H9l-3-4V4Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M6 14v6h12v-6M4 18h16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <symbol id="i-save-lock" viewBox="0 0 24 24">
            <path d="M8 4h8v4H8V4Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M6 8h12v10a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
        </symbol>
        <symbol id="i-save-plus" viewBox="0 0 24 24">
            <path d="M6 4h10l2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M12 9v6M9 12h6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <symbol id="i-copy-new" viewBox="0 0 24 24">
            <path d="M14 2H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M14 2v6h6M12 11v6M9 14h6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>
        <!-- 废稿（稿纸划掉，区别于删除） -->
        <symbol id="i-file-x" viewBox="0 0 24 24">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
            <path d="M14 2v6h6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M8 12l8 8M16 12l-8 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </symbol>

        <!-- 实心图标（主操作） -->
        <symbol id="i-plus-solid" viewBox="0 0 24 24">
            <path d="M11 5a1 1 0 0 1 2 0v6h6a1 1 0 1 1 0 2h-6v6a1 1 0 1 1-2 0v-6H5a1 1 0 1 1 0-2h6V5Z" fill="currentColor"/>
        </symbol>
        <symbol id="i-calc-solid" viewBox="0 0 24 24">
            <path d="M7 2h10a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2Zm2 4h6a1 1 0 0 1 0 2H9a1 1 0 0 1 0-2Zm0 5h1a1 1 0 1 1 0 2H9a1 1 0 1 1 0-2Zm5 0h1a1 1 0 1 1 0 2h-1a1 1 0 1 1 0-2Zm-5 4h1a1 1 0 1 1 0 2H9a1 1 0 1 1 0-2Zm5 0h1a1 1 0 1 1 0 2h-1a1 1 0 1 1 0-2Z" fill="currentColor"/>
        </symbol>

        <!-- 排单区「记录」「统计」线性图标（固定：方案 C + 方案 E） -->
        <symbol id="i-record-c" viewBox="0 0 24 24">
            <path d="M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </symbol>
        <symbol id="i-stats-e" viewBox="0 0 24 24">
            <path d="M3 3v18h18" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M7 14l4-4 4 2 6-6" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </symbol>
        <!-- 方案四：选中加粗描边，加粗版 symbol（stroke-width 2.2） -->
        <symbol id="i-today-calendar-dot-bold" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" fill="none" stroke="currentColor" stroke-width="2.2"/><path d="M16 2v4M8 2v4M3 10h18" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round"/><circle cx="12" cy="16" r="2" fill="currentColor"/></symbol>
        <symbol id="i-save-clipboard-bold" viewBox="0 0 24 24">
            <path d="M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-2" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linejoin="round"/>
            <path d="M8 2h8v4H8V2Z" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linejoin="round"/>
            <path d="M8 13h8M8 17h5" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round"/>
        </symbol>
        <symbol id="i-stats-e-bold" viewBox="0 0 24 24">
            <path d="M3 3v18h18" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M7 14l4-4 4 2 6-6" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/>
        </symbol>
        <symbol id="i-settings-line-p-bold" viewBox="0 0 24 24">
            <rect x="4" y="4" width="6" height="6" rx="1" fill="none" stroke="currentColor" stroke-width="2.2"/>
            <rect x="14" y="4" width="6" height="6" rx="1" fill="none" stroke="currentColor" stroke-width="2.2"/>
            <rect x="4" y="14" width="6" height="6" rx="1" fill="none" stroke="currentColor" stroke-width="2.2"/>
            <rect x="14" y="14" width="6" height="6" rx="1" fill="none" stroke="currentColor" stroke-width="2.2"/>
        </symbol>
        <!-- 导航选中态·实心图标（均用 fill="currentColor" 以便继承按钮颜色） -->
        <symbol id="i-today-calendar-dot-solid" viewBox="0 0 24 24">
            <!-- 日历主体（圆角矩形，与线性版一致 3,4 宽18 高18 rx2） -->
            <path d="M5 4h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z" fill="currentColor"/>
            <!-- 底部圆点 -->
            <circle cx="12" cy="16" r="2" fill="currentColor"/>
            <!-- 顶部两个扣环 -->
            <rect x="8" y="2" width="4" height="4" rx="0.5" fill="currentColor"/>
            <rect x="16" y="2" width="4" height="4" rx="0.5" fill="currentColor"/>
        </symbol>
        <symbol id="i-save-clipboard-solid" viewBox="0 0 24 24">
            <path d="M6 4h12v16H6V4z" fill="currentColor"/>
            <path d="M8 2h8v4H8V2z" fill="currentColor"/>
        </symbol>
        <!-- 统计：L 形坐标轴（实心条）+ 折线下填充区域，真正实心 -->
        <symbol id="i-stats-e-solid" viewBox="0 0 24 24">
            <path d="M3 3h2v18H3V3z M3 19h18v2H3V19z" fill="currentColor"/>
            <polygon points="3,21 3,14 7,14 11,10 15,12 21,6 21,21" fill="currentColor"/>
        </symbol>
        <symbol id="i-settings-line-p-solid" viewBox="0 0 24 24">
            <rect x="4" y="4" width="6" height="6" rx="1" fill="currentColor"/>
            <rect x="14" y="4" width="6" height="6" rx="1" fill="currentColor"/>
            <rect x="4" y="14" width="6" height="6" rx="1" fill="currentColor"/>
            <rect x="14" y="14" width="6" height="6" rx="1" fill="currentColor"/>
        </symbol>
    </svg>

    <div class="app-container">
        <!-- 导航栏：排单/记录/计算/统计/设置（图标+底下文字，灰/黑） -->
        <nav class="navbar">
            <div class="nav-buttons">
                <button class="nav-btn nav-btn-tab nav-btn-quote active" onclick="showPage('quote')" aria-label="排单" title="排单">
                    <span class="nav-tab-icon-wrap">
                        <svg class="nav-tab-icon thin" aria-hidden="true" viewBox="0 0 24 24"><use href="#i-today-calendar-dot"></use></svg>
                        <svg class="nav-tab-icon bold" aria-hidden="true" viewBox="0 0 24 24"><use href="#i-today-calendar-dot-bold"></use></svg>
                    </span>
                    <span class="nav-tab-label">排单</span>
                </button>
                <button class="nav-btn nav-btn-tab nav-btn-record" onclick="showPage('record')" aria-label="记录" title="记录">
                    <span class="nav-tab-icon-wrap">
                        <svg class="nav-tab-icon thin" aria-hidden="true" viewBox="0 0 24 24"><use href="#i-save-clipboard"></use></svg>
                        <svg class="nav-tab-icon bold" aria-hidden="true" viewBox="0 0 24 24"><use href="#i-save-clipboard-bold"></use></svg>
                    </span>
                    <span class="nav-tab-label">记录</span>
                </button>
                <button class="nav-btn nav-btn-plus" id="openCalculatorBtn" type="button" onclick="openCalculatorDrawer()" aria-label="开始计算" title="开始计算">
                    <svg class="icon lg" aria-hidden="true"><use href="#i-plus"></use></svg>
                    <span class="sr-only">开始计算</span>
                </button>
                <button class="nav-btn nav-btn-tab nav-btn-stats" onclick="showPage('stats')" aria-label="统计" title="统计">
                    <span class="nav-tab-icon-wrap">
                        <svg class="nav-tab-icon thin" aria-hidden="true" viewBox="0 0 24 24"><use href="#i-stats-e"></use></svg>
                        <svg class="nav-tab-icon bold" aria-hidden="true" viewBox="0 0 24 24"><use href="#i-stats-e-bold"></use></svg>
                    </span>
                    <span class="nav-tab-label">统计</span>
                </button>
                <button class="nav-btn nav-btn-tab nav-btn-settings" onclick="showPage('settings')" aria-label="设置" title="设置">
                    <span class="nav-tab-icon-wrap">
                        <svg class="nav-tab-icon thin" aria-hidden="true" viewBox="0 0 24 24"><use href="#i-settings-line-p"></use></svg>
                        <svg class="nav-tab-icon bold" aria-hidden="true" viewBox="0 0 24 24"><use href="#i-settings-line-p-bold"></use></svg>
                    </span>
                    <span class="nav-tab-label">设置</span>
                </button>
            </div>
        </nav>

        <!-- 主要内容区域 -->
        <main class="main-content">
            <!-- 计算页抽屉容器（覆盖在报价/设置之上） -->
            <div id="calculatorDrawer" class="calculator-drawer">
                <div class="calculator-drawer-panel">
                    <div class="calculator-drawer-header">
                        <button type="button" class="btn-icon btn--icon btn-close-flat calculator-drawer-close" onclick="closeCalculatorDrawer()" aria-label="关闭计算面板" title="关闭">
                            <svg class="icon" aria-hidden="true"><use href="#i-close"></use></svg>
                            <span class="sr-only">关闭</span>
                        </button>
                        <h2 class="calculator-drawer-title">计算报价</h2>
                        <div class="calculator-actions icon-text-actions">
                            <button type="button" class="icon-text-btn primary" id="calculatorQuoteBtn" onclick="calculatePrice()" title="生成小票并加入排单（编辑模式下覆盖原单）">
                                <svg class="icon sm"><use href="#i-save-clipboard"></use></svg>
                                <span>小票</span>
                            </button>
                            <button type="button" class="icon-text-btn d-none" id="calculatorSaveBtn" onclick="calculatePrice(undefined, undefined, true)" title="保存到排单（选择覆盖或另存新单）">
                                <svg class="icon sm"><use href="#i-save-check"></use></svg>
                                <span>保存</span>
                            </button>
                        </div>
                    </div>
                    <div class="calculator-drawer-body">
                        <!-- 计算页原有内容 -->
                        <div id="calculator" class="calculator-content">
                <div class="section">
                    <h2>单主信息</h2>
                    <div class="form-row">
                        <div class="form-group flex-1">
                            <div class="input-row-with-icon client-id-input-wrap">
                                <input type="text" id="clientId" placeholder="单主ID (可匹配历史)" title="输入单主ID或关键字，匹配到历史单主后点击一项填充" oninput="debouncedShowClientIdMatches()" onblur="scheduleHideClientIdMatchList()">
                                <button class="btn-remark-full" onclick="openOrderRemarkModal()" type="button" title="添加备注；点开后粘贴单主备注可智能提取制品与赠品">
                                    <svg class="icon sm" aria-hidden="true"><use href="#i-note"></use></svg>
                                    <span class="remark-btn-label">
                                        <span class="remark-label-line1">备注</span>
                                        <span class="remark-label-line2">智能提取</span>
                                    </span>
                                </button>
                                <div id="clientIdMatchWrap" class="client-id-match-dropdown d-none">
                                    <ul id="clientIdMatchList"></ul>
                                </div>
                            </div>
                        </div>
                        <div class="order-platform-contact-row flex-1">
                            <div class="form-group">
                                <label for="orderPlatform">接单平台</label>
                                <div id="orderPlatformWrap" class="order-platform-input-wrap">
                                    <input type="text" id="orderPlatform" list="orderPlatformList" placeholder="可直接输入或选QQ/微信/小红书等" title="可直接输入或选择候选；与设置中平台名称一致时自动匹配手续费；框内清空键" oninput="syncOrderPlatformToPlatform(); toggleOrderPlatformClear();" onchange="toggleOrderPlatformClear();">
                                    <button type="button" class="order-platform-clear" onclick="clearOrderPlatformInput()" aria-label="一键清空" title="一键清空">
                                        <svg class="icon sm" aria-hidden="true"><use href="#i-close"></use></svg>
                                        <span class="sr-only">清空</span>
                                    </button>
                                </div>
                                <datalist id="orderPlatformList"><option value="QQ"><option value="微信"><option value="小红书"></datalist>
                            </div>
                            <div class="form-group">
                                <label for="contactInfo">联系方式</label>
                                <input type="text" id="contactInfo" placeholder="QQ号/微信号/手机号等" title="单主联系方式，如QQ号、微信号、手机号">
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group flex-1">
                            <label>彩条配色</label>
                            <button type="button" id="scheduleColorPickerBtn" class="schedule-color-picker-trigger" onclick="openScheduleColorPicker(event)">
                                <span class="schedule-color-preview-bar" id="scheduleColorPreviewBar"></span>
                            </button>
                            <div id="scheduleColorPickerPopover" class="schedule-color-popover d-none">
                                <div class="schedule-color-popover-overlay" onclick="closeScheduleColorPicker()"></div>
                                <div class="schedule-color-popover-panel">
                                    <div class="schedule-color-popover-grid" id="scheduleColorPopoverGrid"></div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group flex-1">
                            <label for="orderTimeInput">下单时间</label>
                            <input type="date" id="orderTimeInput" class="order-time-input" aria-label="下单时间" placeholder="yyyy-mm-dd">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="startTime">开始时间</label>
                            <input type="date" id="startTime" onchange="calculateDeadline()" placeholder="yyyy/mm/dd">
                        </div>
                        <div class="form-group">
                            <label for="deadline">截稿时间</label>
                            <input type="date" id="deadline" placeholder="yyyy/mm/dd">
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-title-row d-flex justify-between items-center">
                        <h2>设置选项</h2>
                        <div class="template-fill-wrap">
                            <button type="button" class="btn" id="templateFillBtn" onclick="toggleTemplateFillDropdown()">模版填表</button>
                            <div id="templateFillDropdown" class="template-fill-dropdown d-none">
                                <select id="templateSelect" onchange="onTemplateSelectChange()">
                                    <option value="">-- 选择模板 --</option>
                                </select>
                                <div class="d-flex gap-2 mt-2">
                                    <button type="button" class="btn small" onclick="loadSelectedTemplate(); closeTemplateFillDropdown();">加载</button>
                                    <button type="button" class="icon-action-btn delete" id="deleteTemplateBtn" onclick="deleteTemplate();" aria-label="删除模板" title="删除">
                                        <svg class="icon sm" aria-hidden="true"><use href="#i-trash-simple"></use></svg>
                                        <span class="sr-only">删除</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 加价类：用途、加急、其他加价类 -->
                    <div class="form-row" id="pricingUpRow">
                        <div class="form-group">
                            <label for="usage">用途</label>
                            <select id="usage"><option value="">--</option></select>
                        </div>
                        <div class="form-group">
                            <label for="urgent">加急</label>
                            <select id="urgent"><option value="">--</option></select>
                        </div>
                    </div>
                    <div id="extraPricingUpSelectsRow" class="form-row d-none">
                        <!-- 动态添加的其他加价类选择器 -->
                    </div>
                    <!-- 折扣类：折扣系数、其他折扣类 -->
                    <div class="form-row" id="pricingDownRow">
                        <div class="form-group">
                            <label for="discount">折扣系数</label>
                            <select id="discount"><option value="">--</option></select>
                        </div>
                    </div>
                    <div id="extraPricingDownSelectsRow" class="form-row d-none">
                        <!-- 动态添加的其他折扣类选择器 -->
                    </div>
                    <!-- 同模系数 -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="sameModel">同模系数</label>
                            <select id="sameModel"><option value="">--</option></select>
                        </div>
                    </div>
                    <!-- 平台费、是否付定金 -->
                    <div class="form-row platform-deposit-row">
                        <div class="form-group">
                            <label for="platform">平台手续费</label>
                            <select id="platform" onchange="onPlatformChangeForDeposit()"><option value="">--</option></select>
                        </div>
                        <div class="form-group">
                            <label for="needDeposit">是否付定金</label>
                            <select id="needDeposit">
                                <option value="no" selected>否</option>
                                <option value="yes">是</option>
                            </select>
                        </div>
                    </div>
                    <!-- 其他费用：单独一行 -->
                    <div class="form-row">
                        <div class="form-group flex-col gap-2 flex-1">
                            <label for="otherFeesList">其他费用</label>
                            <div class="d-flex gap-2 other-fee-container">
                                <select id="otherFeeType" onchange="updateOtherFeeAmount()" class="flex-1 min-w-0">
                                    <option value="custom">自定义</option>
                                    <!-- 其他费用类别将通过JavaScript动态添加 -->
                                </select>
                                <input type="text" id="customOtherFeeName" placeholder="费用名称" class="flex-1 min-w-0">
                                <input type="number" id="otherFeeAmount" placeholder="金额" min="0" step="1" class="w-80">
                            </div>
                            <div id="dynamicOtherFees" class="mt-2 flex-col gap-2">
                                <!-- 动态添加的其他费用将显示在这里 -->
                            </div>
                            <button class="btn small self-start" onclick="addDynamicOtherFee()">+ 其他费用</button>
                        </div>
                    </div>
                </div>

                <div class="section section-products">
                    <h2>制品信息</h2>
                    <div id="productsContainer">
                        <!-- 制品信息将通过JavaScript动态添加 -->
                    </div>
                    <button class="btn add-product" onclick="addProduct()">+ 制品</button>
                </div>
                
                <div class="section">
                    <h2>赠品信息</h2>
                    <div id="giftsContainer">
                        <!-- 赠品信息将通过JavaScript动态添加 -->
                    </div>
                    <button class="btn add-product" onclick="addGift()">+ 赠品</button>
                </div>
                
                        <div class="save-template-row d-flex gap-2 items-center">
                            <!-- 保存按钮放在左侧 -->
                            <button class="btn" onclick="saveTemplate()">保存为模板</button>
                            <!-- 输入框放在右侧 -->
                            <input type="text" id="templateName" placeholder="模板名称">
                        </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 报价页（默认主页面） -->
            <div id="quote" class="page active">
                <!-- 排单日历区（作为排单页主视图），去掉外层卡片框，仅保留排单布局 -->
                <div class="schedule-section">
                    <div class="schedule-toolbar d-flex justify-between items-center">
                        <div class="schedule-title-row">
                            <button type="button" class="btn secondary schedule-title-prev" onclick="scheduleCalendarPrevMonth()">‹</button>
                            <button type="button" class="schedule-title-btn" onclick="openScheduleDatePicker()">
                                <span class="schedule-title-month"></span>
                                <span class="schedule-title-stats"></span>
                            </button>
                            <input type="date" id="scheduleTitleDateInput" class="schedule-title-date-input" placeholder="yyyy/mm/dd">
                            <button type="button" class="btn secondary schedule-title-next" onclick="scheduleCalendarNextMonth()">›</button>
                        </div>
                        <div class="schedule-title-actions d-flex items-center gap-2">
                            <button type="button" class="btn secondary schedule-title-today-pill d-none" id="scheduleTodayBtn" onclick="scheduleTodoBackToToday()" aria-label="返回今日" title="返回今日">Today</button>
                            <button type="button" class="btn secondary btn--icon schedule-title-icon-btn" id="themeToggleBtn" onclick="toggleThemeOnClick()" oncontextmenu="toggleThemeLongPress(event); return false;" aria-label="切换昼夜模式" title="点击切换昼夜，长按跟随系统">
                                <svg class="icon theme-icon-sun" aria-hidden="true"><use href="#i-sun"></use></svg>
                                <svg class="icon theme-icon-moon d-none" aria-hidden="true"><use href="#i-moon"></use></svg>
                            </button>
                        </div>
                    </div>
                    <div id="scheduleCalendar" class="schedule-calendar">
                        <!-- 月历与跨日彩条由 JS 渲染 -->
                    </div>
                    <div id="scheduleTodoSection" class="schedule-todo-section">
                        <div class="schedule-todo-filters-wrap d-flex justify-between items-center">
                            <div class="schedule-todo-filters">
                                <button type="button" class="schedule-todo-filter-btn" data-filter="all" onclick="setScheduleTodoFilter('all')">所有</button>
                                <button type="button" class="schedule-todo-filter-btn" data-filter="month" onclick="setScheduleTodoFilter('month')">当月</button>
                                <button type="button" class="schedule-todo-filter-btn" data-filter="pending" onclick="setScheduleTodoFilter('pending')">待排</button>
                                <button type="button" class="schedule-todo-filter-btn active" data-filter="today" onclick="setScheduleTodoFilter('today')">当日</button>
                            </div>
                        </div>
                        <h3 id="scheduleTodoTitle" class="schedule-todo-title">当前批次（截稿日：—）</h3>
                        <div id="scheduleTodoModules" class="schedule-todo-modules">
                            <!-- 按排单分模块的制品 todo 由 JS 渲染 -->
                        </div>
                    </div>
                </div>

                <!-- 隐藏的主小票真源区域（仅用于渲染与截图，不在排单主视图中展示） -->
                <div class="section quote-main-receipt-section">
                    <div id="quoteContent" class="quote-content">
                        <!-- 报价内容将通过JavaScript动态生成 -->
                    </div>
                </div>

                <!-- 小票抽屉：作为“小票页”，从左侧滑出 -->
                <div id="receiptDrawer" class="receipt-drawer d-none">
                    <div class="receipt-drawer-overlay" onclick="handleReceiptDrawerClose()"></div>
                    <div class="receipt-drawer-panel">
                        <div class="receipt-drawer-header">
                            <button type="button" class="btn-icon btn--icon btn-close-flat receipt-drawer-close" onclick="handleReceiptDrawerClose()" aria-label="关闭小票页" title="关闭">
                                <svg class="icon" aria-hidden="true"><use href="#i-close"></use></svg>
                                <span class="sr-only">关闭</span>
                            </button>
                            <h2 class="receipt-drawer-title">报价小票</h2>
                            <div class="receipt-drawer-actions receipt-drawer-actions-flat">
                                <button type="button" class="icon-text-btn receipt-drawer-save-btn" onclick="handleReceiptSchedule()" title="将当前报价保存到排单列表">
                                    <svg class="icon sm"><use href="#i-save-check"></use></svg>
                                    <span>保存</span>
                                </button>
                            </div>
                        </div>
                        <div class="receipt-drawer-body">
                            <div id="receiptAgreedAmountBar" class="receipt-agreed-amount-bar d-none">
                                <div class="receipt-agreed-row receipt-agreed-row-compact">
                                    <span class="receipt-agreed-label">报价金额<span class="receipt-agreed-note">（不含平台费）</span></span>
                                    <span id="receiptCalcAmount" class="receipt-agreed-value">¥0.00</span>
                                </div>
                                <div class="receipt-agreed-row receipt-agreed-row-inline">
                                    <span class="receipt-agreed-label">约定实收</span>
                                    <div class="receipt-agreed-controls-inline">
                                        <input type="number" id="agreedAmountInput" step="0.01" min="0" placeholder="与单主约定的金额">
                                        <div class="receipt-agreed-btns">
                                            <button type="button" class="btn secondary small" onclick="roundAgreedAmount('floor')" title="向下取整">向下</button>
                                            <button type="button" class="btn secondary small" onclick="roundAgreedAmount('ten')" title="取整到十位">取整到十</button>
                                            <button type="button" class="btn secondary small" onclick="roundAgreedAmount('hundred')" title="取整到百位">取整到百</button>
                                        </div>
                                    </div>
                                </div>
                                <!-- 约定实收下方：已收定金录入 -->
                                <div class="receipt-agreed-row receipt-deposit-row-inline">
                                    <span class="receipt-agreed-label">已收定金</span>
                                    <div class="receipt-agreed-controls-inline">
                                        <input type="number" id="receiptDepositInput" class="receipt-deposit-field" min="0" step="0.01" placeholder="0.00">
                                        <div class="receipt-agreed-btns">
                                            <button type="button" class="btn secondary small" onclick="roundDepositAmount('floor')" title="向下取整">向下</button>
                                            <button type="button" class="btn secondary small" onclick="roundDepositAmount('ten')" title="取整到十位">取整到十</button>
                                            <button type="button" class="btn secondary small" onclick="roundDepositAmount('hundred')" title="取整到百位">取整到百</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="receipt-drawer-toolbar d-flex justify-between items-center">
                                <div class="receipt-drawer-toolbar-left">
                                    <span class="receipt-drawer-subtitle">小票</span>
                                </div>
                                <div class="receipt-drawer-toolbar-actions d-flex gap-2 items-center">
                                    <select id="themeSelector" onchange="applyReceiptTheme(this.value)" class="form-control mr-2">
                                        <option value="classic">经典</option>
                                        <option value="modern">现代</option>
                                        <option value="dark">深色</option>
                                        <option value="vintage">复古</option>
                                        <option value="warm">温馨</option>
                                        <option value="nature">清新</option>
                                        <option value="sakura">粉樱</option>
                                        <option value="iceBlue">冰蓝</option>
                                        <optgroup label="自定义主题" id="customThemesGroup"></optgroup>
                                    </select>
                                    <button class="btn secondary btn--icon" onclick="toggleReceiptCustomizationPanel()" aria-label="小票设置" title="小票设置">
                                        <svg class="icon" aria-hidden="true"><use href="#i-settings-line-c3-l3"></use></svg>
                                        <span class="sr-only">设置</span>
                                    </button>
                                    <button class="btn secondary btn--icon" onclick="saveQuoteAsImage()" aria-label="保存图片" title="存图">
                                        <svg class="icon" aria-hidden="true"><use href="#i-image-line-c"></use></svg>
                                        <span class="sr-only">存图</span>
                                    </button>
                                </div>
                            </div>
                            <div class="receipt-drawer-content">
                                <div id="receiptDrawerContent"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 小票设置弹窗（底部弹出） -->
                <div id="receiptCustomizationModal" class="receipt-customization-modal d-none">
                    <div class="receipt-customization-overlay" onclick="closeReceiptCustomizationPanel()"></div>
                    <div class="receipt-customization-content">
                        <div class="receipt-customization-header">
                            <h2>小票设置</h2>
                            <button class="btn-icon" onclick="closeReceiptCustomizationPanel()">×</button>
                        </div>
                        
                        <div class="receipt-customization-body">
                            <div class="receipt-customization-tabs">
                                <button class="tab-btn active" onclick="switchReceiptTab('settings')">设置</button>
                                <button class="tab-btn" onclick="switchReceiptTab('theme')">主题</button>
                                <button class="tab-btn" onclick="switchReceiptTab('font')">字体</button>
                            </div>
                            <div class="tab-content active" id="settings-tab">

                                <!-- 小票头部设置 -->
                                <div class="section">
                                    <h3>小票头部</h3>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="receiptHeaderImage">小票头部图片</label>
                                            <div class="image-upload-area" id="headerImageUploadArea" ondrop="handleImageDrop(event, 'headerImage')" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                                                <input type="file" id="receiptHeaderImage" accept="image/*" onchange="handleReceiptImageUpload('headerImage', this.files[0])" title="推荐尺寸: 宽度不超过300px" style="display: none;">
                                                <button type="button" class="upload-btn" onclick="document.getElementById('receiptHeaderImage').click()">上传图片</button>
                                                <small class="text-gray">推荐尺寸: 宽度不超过300px，高度自适应 | 支持拖拽上传</small>
                                                <div class="checkbox-row">
                                                    <div class="checkbox-item">
                                                        <span>跟随系统主题颜色</span>
                                                        <label class="custom-toggle">
                                                            <input type="checkbox" id="followSystemTheme" onchange="updateReceiptInfo('followSystemTheme', this.checked)" checked>
                                                            <span class="toggle-slider"></span>
                                                        </label>
                                                    </div>
                                                </div>
                                                <div id="headerImagePreview" class="image-preview"></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="receiptTitleText">小票标题</label>
                                            <input type="text" id="receiptTitleText" placeholder="例如：LIST 或 个人作品报价单" onchange="updateReceiptCustomization('titleText', this.value)">
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="receiptOrderNotification">标题后文本</label>
                                            <input type="text" id="receiptOrderNotification" placeholder="例如：单主ID，你有一份订单请查收~" onchange="updateReceiptInfo('orderNotification', this.value)">
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <div class="checkbox-row">
                                                <div class="checkbox-item">
                                                    <span>开始时间</span>
                                                    <label class="custom-toggle">
                                                        <input type="checkbox" id="showStartTime" onchange="updateReceiptInfo('showStartTime', this.checked)" checked>
                                                        <span class="toggle-slider"></span>
                                                    </label>
                                                </div>
                                                <div class="checkbox-item">
                                                    <span>截稿时间</span>
                                                    <label class="custom-toggle">
                                                        <input type="checkbox" id="showDeadline" onchange="updateReceiptInfo('showDeadline', this.checked)" checked>
                                                        <span class="toggle-slider"></span>
                                                    </label>
                                                </div>
                                                <div class="checkbox-item">
                                                    <span>下单时间</span>
                                                    <label class="custom-toggle">
                                                        <input type="checkbox" id="showOrderTime" onchange="updateReceiptInfo('showOrderTime', this.checked)" checked>
                                                        <span class="toggle-slider"></span>
                                                    </label>
                                                </div>
                                                <div class="checkbox-item">
                                                    <span>设计师</span>
                                                    <label class="custom-toggle">
                                                        <input type="checkbox" id="showDesigner" onchange="updateReceiptInfo('showDesigner', this.checked)" checked>
                                                        <span class="toggle-slider"></span>
                                                    </label>
                                                </div>
                                                <div class="checkbox-item">
                                                    <span>联系方式</span>
                                                    <label class="custom-toggle">
                                                        <input type="checkbox" id="showContactInfo" onchange="updateReceiptInfo('showContactInfo', this.checked)" checked>
                                                        <span class="toggle-slider"></span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="receiptCustomText">制品前文本</label>
                                            <input type="text" id="receiptCustomText" placeholder="输入制品前文本" onchange="updateReceiptInfo('customText', this.value)">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 小票尾部设置 -->
                                <div class="section">
                                    <h3>小票尾部</h3>
                                    <div class="form-row">
                                        <div class="form-group">
                                        <label for="receiptFooterText1">小票尾部图片前文本</label>
                                        <input type="text" id="receiptFooterText1" placeholder="例如：温馨提示" onchange="updateReceiptCustomization('footerText1', this.value)">
                                    </div>
                                    <div class="form-group">
                                        <label for="receiptFooterText2">小票尾部图片后文本</label>
                                        <input type="text" id="receiptFooterText2" placeholder="例如：感谢惠顾" onchange="updateReceiptCustomization('footerText2', this.value)">
                                    </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="receiptFooterImage">小票尾部图片</label>
                                            <div class="image-upload-area" id="footerImageUploadArea" ondrop="handleImageDrop(event, 'footerImage')" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                                                <input type="file" id="receiptFooterImage" accept="image/*" onchange="handleReceiptImageUpload('footerImage', this.files[0])" title="推荐尺寸: 宽度不超过200px" style="display: none;">
                                                <button type="button" class="upload-btn" onclick="document.getElementById('receiptFooterImage').click()">上传图片</button>
                                                <small class="text-gray">推荐尺寸: 宽度不超过200px，高度自适应 | 支持拖拽上传</small>
                                                <small class="text-gray" style="display:block;margin-top:0.25rem">头尾图跟随系统主题颜色由上方「小票头部」中开关统一控制</small>
                                                <div id="footerImagePreview" class="image-preview"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 主题标签页 -->
                            <div class="tab-content" id="theme-tab">
                                <div class="section">
                                    <h3>自定义主题</h3>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="customThemeName">主题名称</label>
                                            <input type="text" id="customThemeName" placeholder="输入主题名称">
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>颜色设置 <span class="color-format-hint">HEX</span></label>
                                            <div class="color-pickers-row">
                                                <div class="color-picker-item">
                                                    <label for="customThemeBg" class="color-picker-label">背景</label>
                                                    <div class="color-picker-wrapper">
                                                        <input type="color" id="customThemeBg" value="#fdfdfd" class="color-picker-round" onchange="updateCustomThemePreview()">
                                                        <span class="color-value" id="customThemeBgValue">#FDFDFD</span>
                                                    </div>
                                                </div>
                                                <div class="color-picker-item">
                                                    <label for="customThemeText" class="color-picker-label">文字</label>
                                                    <div class="color-picker-wrapper">
                                                        <input type="color" id="customThemeText" value="#2d3748" class="color-picker-round" onchange="updateCustomThemePreview()">
                                                        <span class="color-value" id="customThemeTextValue">#2D3748</span>
                                                    </div>
                                                </div>
                                                <div class="color-picker-item">
                                                    <label for="customThemeAccent" class="color-picker-label">强调</label>
                                                    <div class="color-picker-wrapper">
                                                        <input type="color" id="customThemeAccent" value="#4a5568" class="color-picker-round" onchange="updateCustomThemePreview()">
                                                        <span class="color-value" id="customThemeAccentValue">#4A5568</span>
                                                    </div>
                                                </div>
                                                <div class="color-picker-item">
                                                    <label for="customThemeTitle" class="color-picker-label">标题</label>
                                                    <div class="color-picker-wrapper">
                                                        <input type="color" id="customThemeTitle" value="#2d3748" class="color-picker-round" onchange="updateCustomThemePreview()">
                                                        <span class="color-value" id="customThemeTitleValue">#2D3748</span>
                                                    </div>
                                                </div>
                                                <div class="color-picker-item">
                                                    <label for="customThemeDivider" class="color-picker-label">分割</label>
                                                    <div class="color-picker-wrapper">
                                                        <input type="color" id="customThemeDivider" value="#cbd5e0" class="color-picker-round" onchange="updateCustomThemePreview()">
                                                        <span class="color-value" id="customThemeDividerValue">#CBD5E0</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="customThemeBorderRadius">圆角 (px)</label>
                                            <input type="number" id="customThemeBorderRadius" value="0" min="0" max="20">
                                        </div>
                                    </div>
                                    
                                    <!-- 边框设置 -->
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>边框设置</label>
                                            <div class="d-flex flex-wrap gap-2 items-center" style="align-items: center;">
                                                <select id="customThemeBorderStyle" onchange="updateCustomThemeBorder()" class="flex-1" style="min-width: 80px;">
                                                    <option value="none">无边框</option>
                                                    <option value="solid">实线</option>
                                                    <option value="dashed">虚线</option>
                                                    <option value="dotted">点线</option>
                                                    <option value="double">双线</option>
                                                </select>
                                                <input type="number" id="customThemeBorderWidth" value="0" min="0" max="10" step="1" 
                                                       placeholder="宽度" class="w-80" onchange="updateCustomThemeBorder()">
                                                <span>px</span>
                                                <div class="border-color-picker-wrap" title="边框颜色">
                                                    <span class="border-color-swatch" id="customThemeBorderColorSwatch" style="background-color: #cbd5e0;"></span>
                                                    <input type="color" id="customThemeBorderColor" value="#cbd5e0" class="border-color-picker-input" onchange="updateCustomThemeBorder()">
                                                </div>
                                                <span class="color-value" id="customThemeBorderColorValue">#CBD5E0</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 纸张底纹设置 -->
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="customThemeTexture">纸张底纹</label>
                                            <select id="customThemeTexture" onchange="updateCustomThemeTexture()">
                                                <option value="none">无底纹</option>
                                                <option value="paper">纸张纹理</option>
                                                <option value="lined">横线</option>
                                                <option value="grid">网格</option>
                                                <option value="dots">点阵</option>
                                                <option value="vintage">复古纹理</option>
                                                <option value="noise">噪点</option>
                                            </select>
                                            <small class="text-gray">选择纸张底纹样式</small>
                                        </div>
                                        <div class="form-group">
                                            <label for="customThemeTextureOpacity">底纹透明度</label>
                                            <input type="range" id="customThemeTextureOpacity" value="0.1" min="0" max="0.5" step="0.05" 
                                                   onchange="updateCustomThemeTexture()">
                                            <span id="textureOpacityValue" class="text-gray">10%</span>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <button class="btn" onclick="saveCustomTheme()">保存自定义主题</button>
                                            <button class="btn secondary" onclick="loadCurrentThemeToCustom()">从当前主题加载</button>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>已保存的自定义主题</label>
                                            <div id="customThemesList" class="custom-themes-list"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 字体标签页 -->
                            <div class="tab-content" id="font-tab">
                                <div class="section">
                                    <h3>字体设置</h3>
                                    
                                    <!-- 快速设置：统一字体 -->
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>快速设置（统一字体）</label>
                                            <select id="receiptFontFamily" onchange="handleFontFamilyChange(this.value)">
                                                <option value="Courier New, Source Han Sans SC, Noto Sans SC, PingFang SC, Hiragino Sans GB, Courier, Monaco, Consolas, monospace">等宽字体（默认）</option>
                                                <option value="Source Han Sans SC, Noto Sans SC, PingFang SC, sans-serif">无衬线字体</option>
                                                <option value="Source Han Serif SC, Noto Serif SC, Times New Roman, serif">衬线字体</option>
                                                <option value="Source Han Sans SC, Noto Sans SC, sans-serif">思源黑体（推荐）</option>
                                                <option value="Source Han Serif SC, Noto Serif SC, serif">思源宋体（推荐）</option>
                                                <option value="custom">自定义字体</option>
                                            </select>
                                            <div id="customFontContainer" style="display: none; margin-top: 0.5rem;">
                                                <div class="d-flex gap-2 items-center mb-2">
                                                    <input type="text" id="customFontFamily" placeholder="输入字体名称，例如：Arial, Helvetica, 思源黑体" 
                                                           class="flex-1"
                                                           onchange="updateReceiptFont('fontFamily', this.value)"
                                                           onblur="updateReceiptFont('fontFamily', this.value)"
                                                           list="fontSuggestions">
                                                    <button class="btn small" onclick="detectSystemFonts()" title="检测系统可用字体">检测字体</button>
                                                </div>
                                                <div id="detectedFontsList" class="detected-fonts-list" style="display: none; margin-top: 0.5rem;"></div>
                                            </div>
                                            <datalist id="fontSuggestions">
                                                <!-- 免费可商用字体（推荐） -->
                                                <option value="Source Han Sans SC, Noto Sans SC, sans-serif">思源黑体（免费可商用）</option>
                                                <option value="Noto Sans SC, Source Han Sans SC, sans-serif">Noto Sans（免费可商用）</option>
                                                <option value="Source Han Serif SC, Noto Serif SC, serif">思源宋体（免费可商用）</option>
                                                <option value="Noto Serif SC, Source Han Serif SC, serif">Noto Serif（免费可商用）</option>
                                                <option value="LXGW WenKai, sans-serif">霞鹜文楷（免费可商用）</option>
                                                <option value="LXGW WenKai Mono, monospace">霞鹜文楷等宽（免费可商用）</option>
                                                <option value="Ma Shan Zheng, cursive">马善政毛笔（免费可商用）</option>
                                                <option value="ZCOOL KuaiLe, cursive">站酷快乐体（免费可商用）</option>
                                                <option value="ZCOOL XiaoWei, serif">站酷小薇体（免费可商用）</option>
                                                <option value="ZCOOL QingKe HuangYou, sans-serif">站酷庆科黄油体（免费可商用）</option>
                                                <option value="ZCOOL Addict Italic, cursive">站酷高端黑（免费可商用）</option>
                                                <option value="FZShuTi, serif">方正舒体（需授权）</option>
                                                <option value="FZYaoti, cursive">方正姚体（需授权）</option>
                                                <!-- 系统字体（需注意授权） -->
                                                <option value="Arial, sans-serif">Arial（系统字体）</option>
                                                <option value="Helvetica, Arial, sans-serif">Helvetica（系统字体）</option>
                                                <option value="Times New Roman, serif">Times New Roman（系统字体）</option>
                                                <option value="Georgia, serif">Georgia（系统字体）</option>
                                                <option value="Verdana, sans-serif">Verdana（系统字体）</option>
                                                <option value="Courier New, monospace">Courier New（系统字体）</option>
                                                <!-- 需授权字体（仅作参考） -->
                                                <option value="SimHei, sans-serif">黑体（需授权）</option>
                                                <option value="FangSong, serif">仿宋（需授权）</option>
                                                <option value="PingFang SC, sans-serif">苹方（需授权）</option>
                                                <option value="Hiragino Sans GB, sans-serif">冬青黑体（需授权）</option>
                                            </datalist>
                                            <small class="text-gray" id="fontFamilyHint" style="display: none; margin-top: 0.25rem;">
                                                提示：可以输入多个字体，用逗号分隔，系统会按顺序尝试使用。推荐使用标注"免费可商用"的字体（如思源黑体、Noto Sans等），商用更安全。
                                            </small>
                                        </div>
                                    </div>
                                    
                                    <!-- 分类字体设置 -->
                                    <div class="form-row">
                                        <div class="form-group">
                                            <div class="checkbox-row">
                                                <div class="checkbox-item">
                                                    <span>启用分类字体设置</span>
                                                    <label class="custom-toggle">
                                                        <input type="checkbox" id="enableCategoryFonts" onchange="toggleCategoryFonts(this.checked)">
                                                        <span class="toggle-slider"></span>
                                                    </label>
                                                </div>
                                            </div>
                                            <small class="text-gray">开启后可以为小票的不同部分分别设置字体</small>
                                        </div>
                                    </div>
                                    
                                    <div id="categoryFontsContainer" style="display: none;">
                                        <!-- 标题字体 -->
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="fontTitle">标题字体（小票标题）</label>
                                                <input type="text" id="fontTitle" placeholder="留空则使用正文字体" 
                                                       onchange="updateCategoryFont('title', this.value)"
                                                       onblur="updateCategoryFont('title', this.value)"
                                                       list="fontSuggestions">
                                                <small class="text-gray">例如：Source Han Serif SC, Noto Serif SC, serif</small>
                                            </div>
                                        </div>
                                        
                                        <!-- 正文字体 -->
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="fontBody">正文字体（内容、信息行）</label>
                                                <input type="text" id="fontBody" placeholder="留空则使用默认字体" 
                                                       onchange="updateCategoryFont('body', this.value)"
                                                       onblur="updateCategoryFont('body', this.value)"
                                                       list="fontSuggestions">
                                                <small class="text-gray">例如：Source Han Sans SC, Noto Sans SC, sans-serif</small>
                                            </div>
                                        </div>
                                        
                                        <!-- 价格/数字字体 -->
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="fontNumber">价格/数字字体（价格列、金额）</label>
                                                <input type="text" id="fontNumber" placeholder="留空则使用等宽字体" 
                                                       onchange="updateCategoryFont('number', this.value)"
                                                       onblur="updateCategoryFont('number', this.value)"
                                                       list="fontSuggestions">
                                                <small class="text-gray">例如：Courier New, Consolas, Monaco, monospace（推荐等宽字体）</small>
                                            </div>
                                        </div>
                                        
                                        <!-- 汇总字体 -->
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="fontSummary">汇总字体（小计、总计）</label>
                                                <input type="text" id="fontSummary" placeholder="留空则使用正文字体" 
                                                       onchange="updateCategoryFont('summary', this.value)"
                                                       onblur="updateCategoryFont('summary', this.value)"
                                                       list="fontSuggestions">
                                                <small class="text-gray">例如：Source Han Sans SC, Noto Sans SC, sans-serif</small>
                                            </div>
                                        </div>
                                        
                                        <!-- 尾部字体 -->
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="fontFooter">尾部字体（尾部文字）</label>
                                                <input type="text" id="fontFooter" placeholder="留空则使用正文字体" 
                                                       onchange="updateCategoryFont('footer', this.value)"
                                                       onblur="updateCategoryFont('footer', this.value)"
                                                       list="fontSuggestions">
                                                <small class="text-gray">例如：Source Han Sans SC, Noto Sans SC, sans-serif</small>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="receiptFontSize">字号 (px)</label>
                                            <input type="number" id="receiptFontSize" value="13" min="10" max="20" step="1" onchange="updateReceiptFont('fontSize', this.value)">
                                        </div>
                                        <div class="form-group">
                                            <label for="receiptFontWeight">字重</label>
                                            <select id="receiptFontWeight" onchange="updateReceiptFont('fontWeight', this.value)">
                                                <option value="300">细 (300)</option>
                                                <option value="400" selected>正常 (400)</option>
                                                <option value="500">中等 (500)</option>
                                                <option value="600">半粗 (600)</option>
                                                <option value="700">粗体 (700)</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="receiptLineHeight">行高</label>
                                            <input type="number" id="receiptLineHeight" value="1.3" min="1" max="2" step="0.1" onchange="updateReceiptFont('lineHeight', this.value)">
                                        </div>
                                    </div>
                                    
                                    <!-- 导入字体文件 -->
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>导入字体文件</label>
                                            <input type="file" id="fontFileInput" accept=".ttf,.otf,.woff,.woff2" style="display: none;" onchange="handleFontFileUpload(event)">
                                            <button type="button" class="btn small" onclick="document.getElementById('fontFileInput').click()">选择字体文件</button>
                                            <small class="text-gray">支持格式：TTF, OTF, WOFF, WOFF2（建议文件小于5MB）</small>
                                        </div>
                                    </div>
                                    
                                    <!-- 已导入的字体列表 -->
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>已导入的字体</label>
                                            <div id="importedFontsList" class="imported-fonts-list"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="receipt-customization-footer">
                            <button class="btn" onclick="clearReceiptCustomization()">清除设置</button>
                            <button class="btn" onclick="closeReceiptCustomizationPanel()">保存设置</button>
                        </div>
                    </div>
                </div>

                <!-- 历史记录弹窗 -->
                <div id="historyRecordModal" class="history-record-modal d-none">
                    <div class="history-record-overlay" onclick="closeHistoryRecordModal()"></div>
                    <div class="history-record-content">
                        <div class="history-record-header">
                            <h2>记录</h2>
                            <button type="button" class="btn-icon btn--icon btn-close-flat" onclick="closeHistoryRecordModal()" aria-label="关闭" title="关闭">
                                <svg class="icon" aria-hidden="true"><use href="#i-close"></use></svg>
                                <span class="sr-only">关闭</span>
                            </button>
                        </div>
                        <div class="history-record-body">
                            <div class="form-row">
                                <div class="form-group w-full">
                                    <div class="d-flex gap-2">
                                        <input type="text" id="historySearchInput" placeholder="输入关键词搜索..." class="flex-1" oninput="searchHistory()">
                                        <button class="btn secondary btn--icon" onclick="clearHistorySearch()" aria-label="清空搜索" title="清空">
                                            <svg class="icon" aria-hidden="true"><use href="#i-close"></use></svg>
                                            <span class="sr-only">清空</span>
                                        </button>
                                        <button class="btn secondary btn--icon" id="historyFilterBtn" onclick="toggleHistoryFilterDrawer()" aria-label="筛选" title="筛选">
                                            <svg class="icon" aria-hidden="true"><use href="#i-filter"></use></svg>
                                            <span class="sr-only" id="historyFilterBtnText">筛选</span>
                                            <span id="historyFilterBadge" class="filter-badge d-none">0</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div id="historyFilterDrawer" class="history-filter-drawer">
                                <div class="filter-drawer-overlay" onclick="closeHistoryFilterDrawer()"></div>
                                <div class="filter-drawer-content">
                                    <div class="filter-drawer-header">
                                        <h3>筛选与排序</h3>
                                        <button type="button" class="btn-icon btn--icon btn-close-flat" onclick="closeHistoryFilterDrawer()" aria-label="关闭" title="关闭">
                                            <svg class="icon" aria-hidden="true"><use href="#i-close"></use></svg>
                                            <span class="sr-only">关闭</span>
                                        </button>
                                    </div>
                                    <div class="filter-drawer-body">
                                        <div class="filter-section">
                                            <label class="filter-label">时间范围</label>
                                            <select id="historyTimeFilter" class="filter-select" onchange="onHistoryFilterChange()">
                                                <option value="all">全部</option>
                                                <option value="today">今天</option>
                                                <option value="week">最近一周</option>
                                                <option value="month">最近一月</option>
                                                <option value="custom">自定义</option>
                                            </select>
                                            <div id="historyCustomDateRange" class="d-none mt-2">
                                                <input type="date" id="historyStartDate" class="filter-input" onchange="onHistoryFilterChange()" placeholder="yyyy/mm/dd">
                                                <span class="mx-2">至</span>
                                                <input type="date" id="historyEndDate" class="filter-input" onchange="onHistoryFilterChange()" placeholder="yyyy/mm/dd">
                                            </div>
                                        </div>
                                        <div class="filter-section">
                                            <label class="filter-label">价格范围</label>
                                            <div class="d-flex gap-2 items-center">
                                                <input type="number" id="historyMinPrice" class="filter-input flex-1" placeholder="最低价" min="0" step="0.01" onchange="onHistoryFilterChange()">
                                                <span>至</span>
                                                <input type="number" id="historyMaxPrice" class="filter-input flex-1" placeholder="最高价" min="0" step="0.01" onchange="onHistoryFilterChange()">
                                            </div>
                                        </div>
                                        <div class="filter-section">
                                            <label class="filter-label">排序方式</label>
                                            <select id="historySortBy" class="filter-select" onchange="onHistoryFilterChange()">
                                                <option value="time-desc">时间（最新）</option>
                                                <option value="time-asc">时间（最早）</option>
                                                <option value="price-desc">价格（高到低）</option>
                                                <option value="price-asc">价格（低到高）</option>
                                                <option value="client-asc">单主ID（A-Z）</option>
                                                <option value="client-desc">单主ID（Z-A）</option>
                                            </select>
                                        </div>
                                        <div class="filter-section">
                                            <label class="filter-label">显示方式</label>
                                            <select id="historyGroupBy" class="filter-select" onchange="onHistoryFilterChange()">
                                                <option value="none">列表</option>
                                                <option value="month">按月分组</option>
                                            </select>
                                        </div>
                                        <div class="filter-section">
                                            <label class="filter-label">批量操作</label>
                                            <div class="d-flex gap-2">
                                                <button class="btn secondary flex-1" onclick="selectAllHistory()">全选</button>
                                                <button class="btn danger flex-1" id="batchDeleteBtn" onclick="batchDeleteHistory()" disabled>批量删除</button>
                                            </div>
                                        </div>
                                        <div class="filter-section">
                                            <button class="btn w-full" onclick="exportHistoryToExcel(); closeHistoryFilterDrawer();">导出Excel</button>
                                        </div>
                                    </div>
                                    <div class="filter-drawer-footer">
                                        <button class="btn secondary flex-1" onclick="resetHistoryFilters()">重置</button>
                                        <button class="btn flex-1" onclick="applyHistoryFilters(); closeHistoryFilterDrawer();">应用</button>
                                    </div>
                                </div>
                            </div>
                            <div id="historyContainer" class="history-container">
                                <!-- 历史记录由 JS 渲染 -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 记录页（简洁列表：单主ID / 金额 / 完成状态） -->
            <div id="record" class="page">
                <div class="schedule-section">
                    <div class="schedule-toolbar record-page-header">
                        <div class="record-header-main d-flex justify-between items-center">
                            <h2 class="schedule-title record-page-title">记录</h2>
                            <div class="d-flex gap-2 items-center record-page-actions">
                                <input type="file" id="recordSyncImportInput" accept=".json,application/json" class="d-none" aria-hidden="true" onchange="handleRecordSyncImport(event)">
                                <div class="record-export-wrap" style="position:relative">
                                    <button type="button" class="btn secondary btn--icon" id="recordImportBtn" onclick="toggleRecordImportPopover()" aria-label="导入数据" title="导入（文件或剪贴板）" aria-expanded="false" aria-haspopup="true">
                                        <svg class="icon" aria-hidden="true"><use href="#i-import"></use></svg>
                                        <span class="sr-only">导入</span>
                                    </button>
                                    <div id="recordImportPopover" class="record-export-popover d-none" aria-hidden="true">
                                        <p class="record-export-hint">手机端建议用剪贴板：导出时复制，另一设备粘贴导入</p>
                                        <button type="button" class="record-export-opt" onclick="document.getElementById('recordSyncImportInput').click(); closeRecordImportPopover();">选择 JSON 文件</button>
                                        <button type="button" class="record-export-opt" onclick="importSyncDataFromClipboard(); closeRecordImportPopover();">从剪贴板导入</button>
                                    </div>
                                </div>
                                <div class="record-export-wrap" style="position:relative">
                                    <button type="button" class="btn secondary btn--icon" id="recordExportBtn" onclick="toggleRecordExportPopover()" aria-label="导出" title="导出（按当前筛选结果，含时间范围）" aria-expanded="false" aria-haspopup="true">
                                        <svg class="icon" aria-hidden="true"><use href="#i-export"></use></svg>
                                        <span class="sr-only">导出</span>
                                    </button>
                                    <div id="recordExportPopover" class="record-export-popover d-none" aria-hidden="true">
                                        <p class="record-export-hint">按当前筛选结果（含时间、价格）导出</p>
                                        <button type="button" class="record-export-opt" onclick="exportSyncData(); closeRecordExportPopover();">导出 JSON（同步，含全局设置）</button>
                                        <button type="button" class="record-export-opt" onclick="exportSyncDataToClipboard(); closeRecordExportPopover();">复制到剪贴板</button>
                                        <button type="button" class="record-export-opt" onclick="exportRecordToExcel(); closeRecordExportPopover();">导出 Excel</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="record-header-filter">
                            <div class="form-row">
                                <div class="form-group w-full">
                                    <div class="d-flex gap-2">
                                        <div class="record-search-wrap flex-1" id="recordSearchWrap">
                                            <input type="text" id="recordSearchInput" placeholder="输入关键词搜索..." class="record-search-input" oninput="applyRecordFilters(); toggleRecordSearchClear();">
                                            <button type="button" class="record-search-clear" id="recordSearchClearBtn" onclick="clearRecordSearch()" aria-label="清空搜索" title="清空">
                                                <svg class="icon" aria-hidden="true"><use href="#i-close"></use></svg>
                                                <span class="sr-only">清空</span>
                                            </button>
                                        </div>
                                        <select id="recordSortBy" class="d-none" aria-hidden="true">
                                            <option value="time-desc">时间（最新）</option>
                                            <option value="time-asc">时间（最早）</option>
                                            <option value="price-desc">价格（高到低）</option>
                                            <option value="price-asc">价格（低到高）</option>
                                            <option value="client-asc">单主ID（A-Z）</option>
                                            <option value="client-desc">单主ID（Z-A）</option>
                                        </select>
                                        <div class="record-sort-wrap" style="position:relative">
                                            <button type="button" class="btn secondary btn--icon" id="recordSortBtn" onclick="toggleRecordSortPopover()" aria-label="排序" title="排序" aria-expanded="false" aria-haspopup="true">
                                                <svg class="icon" aria-hidden="true"><use href="#i-sort-desc"></use></svg>
                                                <span class="sr-only">排序</span>
                                            </button>
                                            <div id="recordSortPopover" class="record-sort-popover d-none" aria-hidden="true">
                                                <button type="button" class="record-sort-opt" data-sort="time-desc" onclick="setRecordSortValue('time-desc')">时间（最新）</button>
                                                <button type="button" class="record-sort-opt" data-sort="time-asc" onclick="setRecordSortValue('time-asc')">时间（最早）</button>
                                                <button type="button" class="record-sort-opt" data-sort="price-desc" onclick="setRecordSortValue('price-desc')">价格（高到低）</button>
                                                <button type="button" class="record-sort-opt" data-sort="price-asc" onclick="setRecordSortValue('price-asc')">价格（低到高）</button>
                                                <button type="button" class="record-sort-opt" data-sort="client-asc" onclick="setRecordSortValue('client-asc')">单主ID（A-Z）</button>
                                                <button type="button" class="record-sort-opt" data-sort="client-desc" onclick="setRecordSortValue('client-desc')">单主ID（Z-A）</button>
                                            </div>
                                        </div>
                                        <button class="btn secondary page-filter-btn-with-label" id="recordFilterBtn" onclick="toggleRecordFilterDrawer()" aria-label="筛选" title="筛选">
                                            <svg class="icon" aria-hidden="true"><use href="#i-filter"></use></svg>
                                            <span class="page-action-label" id="recordFilterBtnText">筛选</span>
                                            <span id="recordFilterBadge" class="filter-badge d-none">0</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="recordFilterDrawer" class="history-filter-drawer">
                        <div class="filter-drawer-overlay" onclick="closeRecordFilterDrawer()"></div>
                        <div class="filter-drawer-content">
                            <div class="filter-drawer-header">
                                <h3>筛选</h3>
                                <button type="button" class="btn-icon btn--icon btn-close-flat" onclick="closeRecordFilterDrawer()" aria-label="关闭" title="关闭">
                                    <svg class="icon" aria-hidden="true"><use href="#i-close"></use></svg>
                                    <span class="sr-only">关闭</span>
                                </button>
                            </div>
                            <div class="filter-drawer-body">
                                <div class="filter-section">
                                    <label class="filter-label">时间范围</label>
                                    <select id="recordTimeFilter" class="filter-select" onchange="onRecordFilterChange()">
                                        <option value="all">全部</option>
                                        <option value="today">今天</option>
                                        <option value="week">最近一周</option>
                                        <option value="month">最近一月</option>
                                        <option value="custom">自定义</option>
                                    </select>
                                    <div id="recordCustomDateRange" class="d-none mt-2">
                                        <input type="date" id="recordStartDate" class="filter-input" onchange="onRecordFilterChange()" placeholder="yyyy/mm/dd">
                                        <span class="mx-2">至</span>
                                        <input type="date" id="recordEndDate" class="filter-input" onchange="onRecordFilterChange()" placeholder="yyyy/mm/dd">
                                    </div>
                                </div>
                                <div class="filter-section">
                                    <label class="filter-label">状态</label>
                                    <select id="recordStatusFilter" class="filter-select" onchange="onRecordFilterChange()">
                                        <option value="all">全部</option>
                                        <option value="待排单">待排单</option>
                                        <option value="未开始">未开始</option>
                                        <option value="进行中">进行中</option>
                                        <option value="已完成">已完成</option>
                                        <option value="已逾期">已逾期</option>
                                        <option value="已结单">已结单</option>
                                        <option value="已撤单">已撤单</option>
                                        <option value="有废稿">有废稿</option>
                                    </select>
                                </div>
                                <div class="filter-section">
                                    <label class="filter-label">价格范围</label>
                                    <div class="d-flex gap-2 items-center">
                                        <input type="number" id="recordMinPrice" class="filter-input flex-1" placeholder="最低价" min="0" step="0.01" onchange="onRecordFilterChange()">
                                        <span>至</span>
                                        <input type="number" id="recordMaxPrice" class="filter-input flex-1" placeholder="最高价" min="0" step="0.01" onchange="onRecordFilterChange()">
                                    </div>
                                </div>
                                <div class="filter-section">
                                    <label class="filter-label">显示方式</label>
                                    <select id="recordGroupBy" class="filter-select" onchange="onRecordFilterChange(); applyRecordFilters();">
                                        <option value="month">按月分组</option>
                                        <option value="list">全部排序</option>
                                    </select>
                                    <small class="text-gray">全部排序时按当前排序规则整列表显示，不按月份分组</small>
                                </div>
                                <div class="filter-section">
                                    <label class="filter-label">批量操作</label>
                                    <div class="d-flex gap-2">
                                        <button class="btn secondary flex-1" onclick="selectAllHistory()">全选</button>
                                        <button class="btn danger flex-1" id="recordBatchDeleteBtn" onclick="batchDeleteHistory()" disabled>批量删除</button>
                                    </div>
                                </div>
                            </div>
                            <div class="filter-drawer-footer">
                                <button class="btn secondary flex-1" onclick="resetRecordFilters()">重置</button>
                                <button class="btn flex-1" onclick="applyRecordFilters(); closeRecordFilterDrawer();">应用</button>
                            </div>
                        </div>
                    </div>
                    <div id="recordContainer" class="record-container">
                        <!-- 记录列表由 JS 渲染 -->
                    </div>
                </div>
            </div>

            <!-- 导入方式选择弹窗（覆盖 / 新增合并） -->
            <div id="recordImportModeModal" class="history-record-modal d-none" aria-hidden="true">
                <div class="history-record-overlay" onclick="closeRecordImportModeModal()"></div>
                <div class="history-record-content record-import-mode-content">
                    <div class="history-record-header">
                        <h2>选择导入方式</h2>
                        <button type="button" class="btn-icon btn--icon btn-close-flat" onclick="closeRecordImportModeModal()" aria-label="关闭" title="关闭">
                            <svg class="icon" aria-hidden="true"><use href="#i-close"></use></svg>
                            <span class="sr-only">关闭</span>
                        </button>
                    </div>
                    <div class="history-record-body">
                        <p class="mb-2">请选择如何应用导入文件中的数据：</p>
                        <div class="d-flex flex-col gap-2">
                            <button type="button" class="btn secondary w-full" onclick="applyRecordImportOverwrite()">覆盖本机数据</button>
                            <button type="button" class="btn w-full" onclick="applyRecordImportMerge()">新增合并记录</button>
                        </div>
                        <p class="text-gray mt-2" style="font-size:0.85rem;">覆盖：用文件中的记录与设置替换本机。新增：仅将文件中新记录合并到本机，本机设置不变。</p>
                    </div>
                </div>
            </div>

            <!-- 统计页（手机 App 风格） -->
            <div id="stats" class="page">
                <div class="schedule-section stats-page">
                    <header class="stats-header d-flex justify-between items-center">
                        <h1 class="stats-title">统计</h1>
                        <div class="stats-actions d-flex gap-2 items-center">
                            <button type="button" class="btn secondary btn--icon" onclick="exportStatsToExcel()" aria-label="导出" title="导出Excel">
                                <svg class="icon" aria-hidden="true"><use href="#i-export"></use></svg>
                                <span class="sr-only">导出Excel</span>
                            </button>
                            <button type="button" class="btn secondary page-filter-btn-with-label" id="statsFilterBtn" onclick="toggleStatsFilterDrawer()" aria-label="筛选" title="筛选">
                                <svg class="icon" aria-hidden="true"><use href="#i-filter"></use></svg>
                                <span class="page-action-label">筛选</span>
                                <span id="statsFilterBadge" class="filter-badge d-none">0</span>
                            </button>
                        </div>
                    </header>
                    <div class="stats-quick-row d-flex items-center">
                        <button type="button" class="btn secondary small stats-quick-btn" data-range="thisMonth" onclick="setStatsQuickRange('thisMonth')">本月</button>
                        <button type="button" class="btn secondary small stats-quick-btn" data-range="thisYear" onclick="setStatsQuickRange('thisYear')">本年</button>
                        <button type="button" class="btn secondary small stats-quick-btn" data-range="all" onclick="setStatsQuickRange('all')">全部</button>
                        <button type="button" class="btn secondary small stats-quick-btn" id="statsCustomDateToggle" data-range="custom" onclick="toggleStatsCustomDate()">自定义</button>
                    </div>
                    <div id="statsDateNavWrap" class="stats-date-nav-wrap schedule-title-row d-none">
                        <input type="hidden" id="statsViewYear" value="">
                        <input type="hidden" id="statsViewMonth" value="">
                        <button type="button" class="btn secondary schedule-title-prev" id="statsDateNavPrev" onclick="setStatsDateNav(-1)" aria-label="上一月/上一年" title="上一月/上一年">‹</button>
                        <span id="statsDateNavLabel" class="stats-date-nav-label">—</span>
                        <button type="button" class="btn secondary schedule-title-next" id="statsDateNavNext" onclick="setStatsDateNav(1)" aria-label="下一月/下一年" title="下一月/下一年">›</button>
                    </div>
                    <div id="statsCustomDateWrap" class="stats-quick-custom-wrap d-none">
                        <input type="date" id="statsStartDate" class="filter-input" aria-label="开始日期" onchange="onStatsQuickCustomChange()" placeholder="yyyy/mm/dd">
                        <span class="stats-quick-sep">至</span>
                        <input type="date" id="statsEndDate" class="filter-input" aria-label="结束日期" onchange="onStatsQuickCustomChange()" placeholder="yyyy/mm/dd">
                    </div>
                    <select id="statsTimeFilter" class="d-none" aria-hidden="true">
                        <option value="thisMonth">本月</option>
                        <option value="thisYear">本年</option>
                        <option value="all">全部</option>
                        <option value="custom">自定义</option>
                    </select>
                    <div id="statsFilterDrawer" class="history-filter-drawer">
                        <div class="filter-drawer-overlay" onclick="closeStatsFilterDrawer()"></div>
                        <div class="filter-drawer-content">
                            <div class="filter-drawer-header">
                                <h3>筛选与口径</h3>
                                <button type="button" class="btn-icon btn--icon btn-close-flat" onclick="closeStatsFilterDrawer()" aria-label="关闭" title="关闭"><svg class="icon" aria-hidden="true"><use href="#i-close"></use></svg><span class="sr-only">关闭</span></button>
                            </div>
                            <div class="filter-drawer-body">
                                <div class="filter-section">
                                    <label class="filter-label">时间口径</label>
                                    <select id="statsTimeBasis" class="filter-select" onchange="onStatsFilterChange()">
                                        <option value="timestamp">按记录时间</option>
                                        <option value="deadline">按截稿日</option>
                                    </select>
                                    <small class="text-gray">按记录时间：按下单时间筛选与聚合；按截稿日：按截稿时间筛选与聚合（无截稿日的订单不参与）</small>
                                </div>
                                <div class="filter-section">
                                    <label class="filter-label">金额口径（订单）</label>
                                    <select id="statsAmountBasis" class="filter-select" onchange="onStatsFilterChange()">
                                        <option value="finalTotal">实付 (finalTotal)</option>
                                        <option value="totalProductsPrice">制品价 (totalProductsPrice)</option>
                                    </select>
                                </div>
                                <div class="filter-section">
                                    <label class="filter-label">赠品计入方式</label>
                                    <select id="statsGiftMode" class="filter-select" onchange="onStatsFilterChange()">
                                        <option value="exclude">不计入</option>
                                        <option value="zero">按0元计入</option>
                                        <option value="original">按原价计入</option>
                                    </select>
                                    <small class="text-gray">按0元：计入件数/完成率，金额为0；按原价：计入金额贡献（工作量）</small>
                                </div>
                                <div class="filter-section">
                                    <label class="filter-label">订单状态</label>
                                    <select id="statsStatusFilter" class="filter-select" onchange="onStatsFilterChange()">
                                        <option value="all">全部</option>
                                        <option value="待排单">待排单</option>
                                        <option value="未开始">未开始</option>
                                        <option value="进行中">进行中</option>
                                        <option value="已完成">已完成</option>
                                        <option value="已逾期">已逾期</option>
                                        <option value="已撤单">已撤单</option>
                                        <option value="有废稿">有废稿</option>
                                        <option value="已结单">已结单</option>
                                    </select>
                                </div>
                            </div>
                            <div class="filter-drawer-footer">
                                <button type="button" class="btn secondary flex-1" onclick="resetStatsFilters()">重置</button>
                                <button type="button" class="btn flex-1" onclick="applyStatsFilters(); closeStatsFilterDrawer();">应用</button>
                            </div>
                        </div>
                    </div>
                    <details class="stats-note-details">
                        <summary class="stats-note-summary">说明</summary>
                        <p class="stats-note text-gray">时间口径可选「按记录时间」或「按截稿日」；选截稿日时时间范围与趋势均按截稿日统计。选择本月/本年时显示环比上月/去年。赠品「按0元/按原价」仅影响制品项与金额贡献，不代表实收。已结算订单按 settlement 实际金额统计。Top 制品金额为报价明细，非实收。</p>
                    </details>
                    <div id="statsEmptyHint" class="stats-empty-hint d-none" role="status">
                        <!-- 无数据时由 JS 显示 -->
                    </div>
                    <div id="statsKpiGrid" class="stats-kpi-grid">
                        <!-- KPI 卡片由 JS 渲染 -->
                    </div>
                    <div id="statsComparisonWrap" class="stats-comparison-wrap d-none">
                        <!-- 环比/同比由 JS 渲染 -->
                    </div>
                    <div id="statsTrends" class="stats-trends">
                        <!-- 趋势由 JS 渲染 -->
                    </div>
                    <div id="statsCategorySummary" class="stats-category-summary">
                        <!-- 制品小类汇总由 JS 渲染 -->
                    </div>
                    <div id="statsDistribution" class="stats-distribution d-none">
                        <!-- 数据分布：状态/用途/加急/工艺由 JS 渲染 -->
                    </div>
                    <div id="statsTopLists" class="stats-top-lists">
                        <!-- Top 单主由 JS 渲染，默认前3，更多显示全部 -->
                    </div>
                </div>
            </div>

            <!-- 设置页 -->
            <div id="settings" class="page">
                <!-- 美工信息 -->
                <div class="section">
                    <div class="section-title-row d-flex justify-between items-center">
                        <h2>美工信息</h2>
                        <a href="操作指南.html" target="_blank" rel="noopener" class="guide-link-with-icon" title="操作指南">
                            <svg class="icon sm" aria-hidden="true"><use href="#i-note"></use></svg>
                            <span>操作指南</span>
                        </a>
                    </div>
                    <div class="form-row artist-info-row-1">
                        <div class="form-group">
                            <label for="artistId">美工ID</label>
                            <input type="text" id="artistId" placeholder="请输入美工ID" onchange="updateArtistInfo('id', this.value)">
                        </div>
                        <div class="form-group">
                            <label for="artistContact">联系方式</label>
                            <input type="text" id="artistContact" placeholder="请输入联系方式" onchange="updateArtistInfo('contact', this.value)">
                        </div>
                    </div>
                    <div class="form-row artist-info-row-2">
                        <div class="form-group">
                            <label for="defaultDuration">默认工期（天）</label>
                            <input type="number" id="defaultDuration" placeholder="请输入默认工期" min="0" step="1" onchange="updateArtistInfo('defaultDuration', this.value)">
                            <small class="text-gray">填写开始时间后自动计算截稿时间</small>
                        </div>
                        <div class="form-group">
                            <label for="depositRate">定金比例（%）</label>
                            <input type="number" id="depositRate" placeholder="如 50" min="0" max="100" step="1" onchange="updateDepositRate(this.value)">
                            <small class="text-gray">小票可显示「需付定金」= 实付×比例</small>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="d-flex justify-between items-center mb-4 flex-wrap gap-2">
                        <h2>制品设置</h2>
                        <div class="d-flex items-center gap-2">
                            <button class="btn add-product-setting btn-compact" onclick="openAddProductModal()">添加</button>
                            <button class="btn secondary btn-compact" onclick="document.getElementById('excelImportInput').click()">导入</button>
                            <button class="btn secondary btn-compact" onclick="exportToExcel()">导出</button>
                            <input type="file" id="excelImportInput" accept=".xlsx,.xls" class="d-none" onchange="importFromExcel(event)">
                        </div>
                    </div>
                    <div id="productSettingsContainer">
                    <!-- 制品设置将通过JavaScript动态添加 -->
                    </div>
                
                    <!-- 添加制品弹窗 -->
                    <div id="addProductModal" class="modal d-none">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h3>添加制品设置</h3>
                                <span class="close" onclick="closeAddProductModal()">&times;</span>
                            </div>
                            <div class="modal-body">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>分类</label>
                                        <div id="newProductCategorySelect"></div>
                                    </div>
                                    <div class="form-group">
                                        <label>制品名称</label>
                                        <input type="text" id="newProductName" placeholder="请输入制品名称">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>计价方式</label>
                                        <select id="newProductPriceType">
                                            <option value="fixed">固定价</option>
                                            <option value="double">单双面价</option>
                                            <option value="config">基础+递增价</option>
                                            <option value="nodes">按节点收费</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <!-- 固定价设置 -->
                                <div id="fixedPriceSettings" class="price-settings">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>固定价格</label>
                                            <input type="number" id="newProductPrice" placeholder="请输入固定价格" min="0" step="1">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 单双面价设置 -->
                                <div id="doublePriceSettings" class="price-settings d-none">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>单面价格</label>
                                            <input type="number" id="newProductPriceSingle" placeholder="请输入单面价格" min="0" step="1">
                                        </div>
                                        <div class="form-group">
                                            <label>双面价格</label>
                                            <input type="number" id="newProductPriceDouble" placeholder="请输入双面价格" min="0" step="1">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 基础+递增价设置 -->
                                <div id="configPriceSettings" class="price-settings d-none">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>基础配置</label>
                                            <input type="text" id="newProductBaseConfig" placeholder="例如：立牌+底座">
                                        </div>
                                        <div class="form-group">
                                            <label>基础价</label>
                                            <input type="number" id="newProductBasePrice" placeholder="请输入基础价" min="0" step="1">
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group flex-1">
                                            <label>递增配置项</label>
                                            <div id="additionalConfigsContainer"></div>
                                            <button type="button" class="btn secondary mt-2" onclick="addAdditionalConfig()">+ 配置项</button>
                                        </div>
                                    </div>
                                </div>
                                <!-- 按节点收费设置 -->
                                <div id="nodePriceSettings" class="price-settings d-none">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>默认总价（元）</label>
                                            <input type="number" id="newProductNodePrice" placeholder="例如：300" min="0" step="1">
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group flex-1">
                                            <label>节点列表（比例之和须为 100%）</label>
                                            <div id="newProductNodesContainer"></div>
                                            <button type="button" class="btn secondary mt-2" onclick="addNewProductNode()">+ 添加节点</button>
                                            <p id="newProductNodesSumHint" class="text-gray text-sm mt-1"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button class="btn" onclick="saveNewProduct()">保存</button>
                                <button class="btn secondary" onclick="closeAddProductModal()">取消</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <div class="d-flex justify-between items-center mb-4 flex-wrap gap-2">
                        <h2>系数设置</h2>
                        <div class="d-flex items-center gap-2">
                            <button class="btn add-product-setting btn-compact" onclick="openAddCoefficientModal()">添加</button>
                            <button class="btn secondary btn-compact" onclick="document.getElementById('coefficientExcelImportInput').click()">导入</button>
                            <button class="btn secondary btn-compact" onclick="exportCoefficientsToExcel()">导出</button>
                            <input type="file" id="coefficientExcelImportInput" accept=".xlsx,.xls" class="d-none" onchange="importCoefficientsFromExcel(event)">
                        </div>
                    </div>

                    <!-- 加价类：用途系数、加急系数，可添加其他（可折叠大组） -->
                    <div class="category-group-container">
                        <div class="category-group-header" onclick="toggleCategoryGroup('categoryGroupPricingUp')">
                            <span class="coefficient-class-title">加价类</span>
                            <div class="category-group-toggle" id="categoryGroupPricingUp-toggle">▼</div>
                        </div>
                        <div class="category-group-content d-none" id="categoryGroupPricingUp-content">
                            <!-- 用途系数 -->
                            <div class="category-container">
                                <div class="category-header" onclick="toggleCategory('usageCoefficient')">
                                    <div class="category-title">用途系数</div>
                                    <div class="category-toggle">▼</div>
                                </div>
                                <div class="category-content d-none" id="usageCoefficient-content">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <div class="coefficient-settings" id="usageCoefficientSettings">
                                                <!-- 用途系数将通过JavaScript动态生成 -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- 加急系数 -->
                            <div class="category-container">
                                <div class="category-header" onclick="toggleCategory('urgentCoefficient')">
                                    <div class="category-title">加急系数</div>
                                    <div class="category-toggle">▼</div>
                                </div>
                                <div class="category-content d-none" id="urgentCoefficient-content">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <div class="coefficient-settings">
                                                <!-- 加急系数将通过JavaScript动态生成 -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="extraPricingUpContainer"></div>
                            <!-- 加价类、折扣类均为单数时：加价类最后一项与折扣类第一项并排显示 -->
                            <div id="urgentDiscountPairRow" class="coefficient-pair-row d-none"></div>
                        </div>
                    </div>
                    
                    <!-- 折扣类：折扣系数，可添加其他（可折叠大组） -->
                    <div class="category-group-container">
                        <div class="category-group-header" onclick="toggleCategoryGroup('categoryGroupPricingDown')">
                            <span class="coefficient-class-title">折扣类</span>
                            <div class="category-group-toggle" id="categoryGroupPricingDown-toggle">▼</div>
                        </div>
                        <div class="category-group-content d-none" id="categoryGroupPricingDown-content">
                            <!-- 折扣系数 -->
                            <div class="category-container">
                                <div class="category-header" onclick="toggleCategory('discountCoefficient')">
                                    <div class="category-title">折扣系数</div>
                                    <div class="category-toggle">▼</div>
                                </div>
                                <div class="category-content d-none" id="discountCoefficient-content">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <div class="coefficient-settings">
                                                <!-- 折扣系数将通过JavaScript动态生成 -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="extraPricingDownContainer"></div>
                        </div>
                    </div>
                    
                    <!-- 其他类：同模系数、平台手续费、其他费用（可折叠大组） -->
                    <div class="category-group-container">
                        <div class="category-group-header" onclick="toggleCategoryGroup('categoryGroupOther')">
                            <span class="coefficient-class-title">其他类</span>
                            <div class="category-group-toggle" id="categoryGroupOther-toggle">▼</div>
                        </div>
                        <div class="category-group-content d-none" id="categoryGroupOther-content">
                            <!-- 同模系数 -->
                    <div class="category-container">
                        <div class="category-header" onclick="toggleCategory('sameModelCoefficient')">
                            <div class="category-title">同模系数</div>
                            <div class="category-toggle">▼</div>
                        </div>
                        <div class="category-content d-none" id="sameModelCoefficient-content">
                            <div class="form-row">
                                <div class="form-group">
                                    <div class="coefficient-settings">
                                        <!-- 同模系数将通过JavaScript动态生成 -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 平台手续费 -->
                    <div class="category-container">
                        <div class="category-header" onclick="toggleCategory('platformFee')">
                            <div class="category-title">平台手续费</div>
                            <div class="category-toggle">▼</div>
                        </div>
                        <div class="category-content d-none" id="platformFee-content">
                            <div class="form-row">
                                <div class="form-group">
                                    <div class="coefficient-settings">
                                        <!-- 平台手续费将通过JavaScript动态生成 -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 背景费设置 -->
                    <div class="category-container">
                        <div class="category-header" onclick="toggleCategory('backgroundFee')">
                            <div class="category-title">背景费</div>
                            <div class="category-toggle">▼</div>
                        </div>
                        <div class="category-content d-none" id="backgroundFee-content">
                            <div class="form-row">
                                <div class="form-group">
                                    <div class="coefficient-settings">
                                        <div class="mb-2 d-flex items-center gap-2">
                                            <input type="text" value="背景费" class="flex-1" readonly>
                                            <input type="number" id="backgroundFeeInput" min="0" step="1" class="w-80" 
                                                   onchange="updateBackgroundFee(this.value)">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 其他费用 -->
                    <div class="category-container">
                        <div class="category-header" onclick="toggleCategory('otherFees')">
                            <div class="category-title">其他费用</div>
                            <div class="category-toggle">▼</div>
                        </div>
                        <div class="category-content d-none" id="otherFees-content">
                            
                            <!-- 其他费用类别 -->
                            <div class="form-row mt-4">
                                <div class="form-group flex-1">
                                    <label>其他费用类别</label>
                                    <div class="d-flex gap-2 mt-2 flex-wrap">
                                        <input type="text" id="newOtherFeeName" placeholder="费用名称" class="flex-1 min-w-0">
                                        <input type="number" id="newOtherFeeAmount" placeholder="金额" min="0" step="1" class="w-80">
                                        <button class="btn btn-compact" onclick="addOtherFee()">添加</button>
                                    </div>
                                </div>
                            </div>
                            <!-- 其他费用列表 -->
                            <div id="otherFeesList" class="other-fees-list mt-4 ml-4">
                                <!-- 其他费用列表将通过JavaScript动态生成 -->
                            </div>
                        </div>
                    </div>
                        </div>
                    </div>
                    
                    <!-- 结算配置：与加价类、折扣类、其他类同级 -->
                    <div class="category-group-container">
                        <div class="category-group-header" onclick="toggleCategoryGroup('categoryGroupSettlement')">
                            <span class="coefficient-class-title">结算配置</span>
                            <div class="category-group-toggle" id="categoryGroupSettlement-toggle">▼</div>
                        </div>
                        <div class="category-group-content d-none" id="categoryGroupSettlement-content">
                            <!-- 跑单相关 -->
                            <div class="category-container settlement-group">
                                <div class="category-header" onclick="toggleCategory('cancelFeeRules')">
                                    <div class="category-title">跑单相关</div>
                                    <div class="category-toggle">▼</div>
                                </div>
                                <div class="category-content d-none" id="cancelFeeRules-content">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>撤单跑单费默认规则</label>
                                            <select id="cancelFeeRule" onchange="updateSettlementRule('cancelFee','defaultRule',this.value)">
                                                <option value="percent">按比例</option>
                                                <option value="fixed">固定金额</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label>默认比例（%）</label>
                                            <input type="number" id="cancelFeeRate" min="0" max="100" step="0.1" onchange="updateSettlementRule('cancelFee','defaultRate',this.value/100)">
                                        </div>
                                        <div class="form-group">
                                            <label>默认固定金额（元）</label>
                                            <input type="number" id="cancelFeeFixed" min="0" step="1" onchange="updateSettlementRule('cancelFee','defaultFixedAmount',this.value)">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- 废稿相关 -->
                            <div class="category-container settlement-group">
                                <div class="category-header" onclick="toggleCategory('wasteFeeRules')">
                                    <div class="category-title">废稿相关</div>
                                    <div class="category-toggle">▼</div>
                                </div>
                                <div class="category-content d-none" id="wasteFeeRules-content">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="wasteRuleMode">废稿费模式</label>
                                            <select id="wasteRuleMode" onchange="updateWasteRuleMode(this.value)">
                                                <option value="percent_total">按原总额比例</option>
                                                <option value="percent_charged_only">按已完成制品及工艺比例（按件+同模+工艺层数+废稿比例）</option>
                                                <option value="fixed_per_item">按件固定</option>
                                                <option value="fixed_amount">按固定金额</option>
                                            </select>
                                            <small class="text-gray">废稿页将只显示此模式</small>
                                        </div>
                                    </div>
                                    <div id="wasteRateDefaultWrap" class="form-row">
                                        <div class="form-group">
                                            <label for="wasteRateDefault">默认比例（%）</label>
                                            <input type="number" id="wasteRateDefault" placeholder="如 30" min="0" max="100" step="1" onchange="updateWasteRateDefault(this.value)">
                                            <small class="text-gray">用于「按原总额比例」「按已完成制品及工艺比例」</small>
                                        </div>
                                    </div>
                                    <div id="wasteFixedPerItemDefaultWrap" class="form-row d-none">
                                        <div class="form-group">
                                            <label for="wasteFixedPerItemDefault">默认按件金额（元）</label>
                                            <input type="number" id="wasteFixedPerItemDefault" placeholder="如 20" min="0" step="1" onchange="updateWasteFixedPerItemDefault(this.value)">
                                            <small class="text-gray">用于「按件固定」</small>
                                        </div>
                                    </div>
                                    <div id="wasteFixedAmountDefaultWrap" class="form-row d-none">
                                        <div class="form-group">
                                            <label for="wasteFixedAmountDefault">默认固定金额（元）</label>
                                            <input type="number" id="wasteFixedAmountDefault" placeholder="如 50" min="0" step="0.01" onchange="updateWasteFixedAmountDefault(this.value)">
                                            <small class="text-gray">用于「按固定金额」，与订单金额无关</small>
                                        </div>
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="wasteMinAmountDefault">保底金额（元，可选）</label>
                                            <input type="number" id="wasteMinAmountDefault" placeholder="留空表示无保底" min="0" step="1" onchange="updateWasteMinAmountDefault(this.value)">
                                        </div>
                                        <div class="form-group">
                                            <label for="wasteMaxAmountDefault">封顶金额（元，可选）</label>
                                            <input type="number" id="wasteMaxAmountDefault" placeholder="留空表示不封顶" min="0" step="1" onchange="updateWasteMaxAmountDefault(this.value)">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- 优惠原因（结单时可选，可设默认金额/默认折扣） -->
                            <div class="category-container settlement-group">
                                <div class="category-header" onclick="toggleCategory('discountReasons')">
                                    <div class="category-title">优惠原因</div>
                                    <div class="category-actions">
                                        <button type="button" class="btn btn-compact" onclick="event.stopPropagation();openAddDiscountReasonModal()">添加</button>
                                        <div class="category-toggle">▼</div>
                                    </div>
                                </div>
                                <div class="category-content d-none" id="discountReasons-content">
                                    <p class="text-gray" style="font-size:0.85rem; margin-bottom:0.5rem;">结单时可在结算弹窗中选择优惠原因，选中后自动带出默认金额或默认折扣；可在此增删改。</p>
                                    <div id="discountReasonsList" class="discount-reasons-list">
                                        <!-- 由 JS 渲染 -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 工艺设置：与制品设置同级，可折叠 -->
                <div class="section">
                    <div class="category-container">
                        <div class="category-header" onclick="toggleCategory('process')">
                            <div class="category-title">工艺设置</div>
                            <div class="category-actions">
                                <button class="btn add-process-setting btn-compact" onclick="event.stopPropagation();openAddProcessModal()">添加</button>
                                <div class="category-toggle">▼</div>
                            </div>
                        </div>
                        <div class="category-content d-none" id="process-content">
                            <div id="processSettingsContainer">
                                <!-- 工艺设置将通过JavaScript动态添加 -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 添加系数弹窗 -->
                <div id="addCoefficientModal" class="modal d-none">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>添加系数</h3>
                            <span class="close" onclick="closeAddCoefficientModal()">&times;</span>
                        </div>
                        <div class="modal-body">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="coefficientCategory">系数大类</label>
                                    <select id="coefficientCategory" onchange="updateCoefficientSubType()">
                                        <option value="pricingUp">加价类</option>
                                        <option value="pricingDown">折扣类</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>系数小类</label>
                                    <div id="coefficientTypeSelect"></div>
                                    <small id="coefficientTypeHint">根据上方选择的大类输入系数名称</small>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>系数值项</label>
                                    <div id="coefficientItemsContainer" style="display: flex; flex-direction: column; gap: 0.5rem;">
                                        <!-- 系数值项将通过JavaScript动态添加 -->
                                    </div>
                                    <button type="button" class="btn secondary mt-2" onclick="addCoefficientItem()">+ 系数值</button>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn" onclick="saveNewCoefficient()">保存</button>
                            <button class="btn secondary" onclick="closeAddCoefficientModal()">取消</button>
                        </div>
                    </div>
                </div>
                
                <!-- 添加工艺设置弹窗 -->
                <div id="addProcessModal" class="modal d-none">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>添加工艺设置</h3>
                            <span class="close" onclick="closeAddProcessModal()">&times;</span>
                        </div>
                        <div class="modal-body">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="newProcessName">工艺名称</label>
                                    <input type="text" id="newProcessName" placeholder="请输入工艺名称">
                                </div>
                                <div class="form-group">
                                    <label for="newProcessPrice">价格（每层）</label>
                                    <input type="number" id="newProcessPrice" min="0" step="1">
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn" onclick="saveNewProcess()">保存</button>
                            <button class="btn secondary" onclick="closeAddProcessModal()">取消</button>
                        </div>
                    </div>
                </div>

                <!-- 添加/编辑优惠原因弹窗 -->
                <div id="addDiscountReasonModal" class="modal d-none">
                    <div class="modal-content modal-content-compact">
                        <div class="modal-header">
                            <h3 id="addDiscountReasonModalTitle">添加优惠原因</h3>
                            <span class="close" onclick="closeAddDiscountReasonModal()">&times;</span>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" id="editDiscountReasonId" value="">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="discountReasonName">名称</label>
                                    <input type="text" id="discountReasonName" placeholder="如延期补偿、老客优惠">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="discountReasonPreferType">默认优惠方式</label>
                                    <select id="discountReasonPreferType">
                                        <option value="amount">减去金额</option>
                                        <option value="rate">优惠折扣</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="discountReasonDefaultAmount">默认金额（元，选「减去金额」时生效）</label>
                                    <input type="number" id="discountReasonDefaultAmount" min="0" step="0.01" value="0" placeholder="0">
                                </div>
                                <div class="form-group">
                                    <label for="discountReasonDefaultRate">默认折扣（0~0.99，选「优惠折扣」时生效，如 0.95=95折）</label>
                                    <input type="number" id="discountReasonDefaultRate" min="0" max="0.99" step="0.01" value="0.99" placeholder="0.99">
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn" onclick="saveDiscountReason()">保存</button>
                            <button class="btn secondary" onclick="closeAddDiscountReasonModal()">取消</button>
                        </div>
                    </div>
                </div>
                
                <div class="d-flex gap-2 flex-wrap items-center">
                    <button type="button" class="btn save-settings" onclick="saveSettings()">立即保存</button>
                    <button type="button" class="btn secondary" onclick="resetToDefaultSettings()">恢复默认设置</button>
                </div>
            </div>
            

        <!-- 排单卡片操作弹窗（全局：排单页/记录页点击弹出） -->
        <div id="scheduleTodoCardModal" class="schedule-todo-card-modal d-none">
            <div class="schedule-todo-card-modal-overlay" onclick="closeScheduleTodoCardModal()"></div>
            <div class="schedule-todo-card-modal-content">
                <button type="button" class="schedule-todo-card-modal-close schedule-todo-card-modal-close-float" onclick="closeScheduleTodoCardModal()" aria-label="关闭">×</button>
                <div class="schedule-todo-card-modal-body">
                    <div class="schedule-todo-card-modal-row">
                        <button type="button" class="schedule-todo-card-modal-btn" onclick="scheduleTodoCardAction('edit')" title="编辑">
                            <svg class="icon" aria-hidden="true"><use href="#i-edit"></use></svg>
                            <span>编辑</span>
                        </button>
                        <button type="button" class="schedule-todo-card-modal-btn" onclick="scheduleTodoCardAction('receipt')" title="小票">
                            <svg class="icon" aria-hidden="true"><use href="#i-image-line-c"></use></svg>
                            <span>小票</span>
                        </button>
                        <button type="button" class="schedule-todo-card-modal-btn" onclick="scheduleTodoCardAction('remark')" title="备注">
                            <svg class="icon" aria-hidden="true"><use href="#i-note"></use></svg>
                            <span>备注</span>
                        </button>
                    </div>
                    <div class="schedule-todo-card-modal-row">
                        <button type="button" class="schedule-todo-card-modal-btn" onclick="scheduleTodoCardAction('cancel')" title="撤单">
                            <svg class="icon" aria-hidden="true"><use href="#i-x-circle"></use></svg>
                            <span>撤单</span>
                        </button>
                        <button type="button" class="schedule-todo-card-modal-btn" onclick="scheduleTodoCardAction('waste_fee')" title="废稿">
                            <svg class="icon" aria-hidden="true"><use href="#i-minus-circle"></use></svg>
                            <span>废稿</span>
                        </button>
                        <button type="button" class="schedule-todo-card-modal-btn" onclick="scheduleTodoCardAction('normal')" title="结单">
                            <svg class="icon" aria-hidden="true"><use href="#i-check-circle"></use></svg>
                            <span>结单</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

            <!-- 结算弹窗（全局：与 main 平级，记录页/排单页点击撤单/废稿/结单均可见） -->
            <div id="settlementModal" class="settlement-modal d-none">
                <div class="settlement-modal-overlay" onclick="closeSettlementModal()"></div>
                <div class="settlement-modal-content">
                    <div class="settlement-modal-handle" onclick="closeSettlementModal()" aria-hidden="true"></div>
                    <div class="settlement-modal-header">
                        <h3 id="settlementModalTitle">结算</h3>
                        <button type="button" class="settlement-modal-close" onclick="closeSettlementModal()" aria-label="关闭">×</button>
                    </div>
                    <div class="settlement-modal-body">
                        <div id="settlementStep1" class="settlement-step">
                            <p class="settlement-step-label">选择结算类型</p>
                            <div class="settlement-type-options">
                                <label class="settlement-type-option">
                                    <input type="radio" name="settlementType" value="cancel">
                                    <span class="settlement-type-title">撤单</span>
                                    <span class="settlement-type-desc">退全款或收跑单费</span>
                                </label>
                                <label class="settlement-type-option">
                                    <input type="radio" name="settlementType" value="waste_fee">
                                    <span class="settlement-type-title">废稿</span>
                                    <span class="settlement-type-desc">收废稿费</span>
                                </label>
                                <label class="settlement-type-option">
                                    <input type="radio" name="settlementType" value="normal">
                                    <span class="settlement-type-title">结单</span>
                                    <span class="settlement-type-desc">按原价或折扣结算</span>
                                </label>
                            </div>
                        </div>
                        <div id="settlementStep2" class="settlement-step d-none">
                            <div id="settlementFormCancel" class="settlement-form d-none">
                                <p class="settlement-step-label">撤单方式</p>
                                <div class="settlement-cancel-method-row">
                                    <label class="settlement-cancel-method-opt"><input type="radio" name="cancelSubType" value="full_refund" checked> 退全款</label>
                                    <label class="settlement-cancel-method-opt"><input type="radio" name="cancelSubType" value="cancel_with_fee"> 收跑单费</label>
                                </div>
                                <div id="settlementFullRefundPanel" class="settlement-cancel-panel">
                                    <label>已退款金额（元）<input type="number" id="settlementFullRefundAmount" min="0" step="0.01" value="0" placeholder="与需退金额一致即已退清"></label>
                                    <label>备注（可选）<input type="text" id="settlementMemoRefund" class="settlement-input" placeholder="如撤单原因"></label>
                                </div>
                                <div id="settlementCancelWithFee" class="settlement-cancel-panel d-none">
                                    <div class="settlement-cancel-fee-rule">
                                        <p class="settlement-step-label">跑单费规则</p>
                                        <select id="settlementCancelFeeRule">
                                            <option value="percent">按原价比例</option>
                                            <option value="fixed">固定金额</option>
                                        </select>
                                    </div>
                                    <div class="settlement-cancel-fee-params">
                                        <label>比例（%，如 10 表示 10%）<input type="number" id="settlementCancelFeeRate" min="0" max="100" step="0.1" placeholder="10"></label>
                                        <label>固定金额（元）<input type="number" id="settlementCancelFeeFixed" min="0" step="1" placeholder="0"></label>
                                    </div>
                                    <label>备注（可选）<input type="text" id="settlementMemoCancelFee" class="settlement-input" placeholder="如撤单原因"></label>
                                    <label>跑单费（应收，元）<input type="number" id="settlementCancelFeeAmount" min="0" step="0.01" value="0" placeholder="定金可抵扣，抵扣后为本次收款"></label>
                                </div>
                            </div>
                            <div id="settlementFormWasteFee" class="settlement-form settlement-form-waste d-none">
                                <div class="settlement-form-block settlement-waste-rule">
                                    <p class="settlement-step-label">废稿费规则</p>
                                    <select id="settlementWasteRule" style="display:none;">
                                        <option value="percent_total">按原总额比例</option>
                                        <option value="percent_charged_only">按已完成制品及工艺比例（按件+同模+工艺层数+废稿比例）</option>
                                        <option value="fixed_per_item">按件固定</option>
                                        <option value="fixed_amount">按固定金额</option>
                                    </select>
                                    <p class="settlement-waste-mode-hint" style="color: var(--text-light); font-size: 0.85rem; margin-top: 0.25rem;">当前使用「<span id="settlementWasteModeText">按原总额比例</span>」模式（在设置页可更改）</p>
                                </div>
                                <div id="settlementWasteByPieceWrap" class="settlement-form-block settlement-waste-by-piece d-none">
                                    <div class="settlement-waste-module">
                                        <p class="settlement-step-label">一、制品明细</p>
                                        <div id="settlementWasteDetailTable" class="settlement-waste-detail-table"></div>
                                        <p class="settlement-waste-detail-summary settlement-waste-receivable-line">废稿制品应收：<span id="settlementWasteDetailAmount">¥0.00</span> × <span id="settlementWasteRatio">30%</span> = <span id="settlementWasteDetailTotal">¥0.00</span></p>
                                    </div>
                                    <div class="settlement-waste-module">
                                        <p class="settlement-step-label">二、参与计算的费用系数</p>
                                        <p class="settlement-hint">在原订单已有基础上勾选，取值来自原订单，不含同模</p>
                                        <div id="settlementCoefficientsIncluded" class="settlement-coefficients-included"></div>
                                        <p class="settlement-waste-detail-summary settlement-waste-receivable-line">废稿费小计：<span id="settlementWasteFeeSubtotal">¥0.00</span></p>
                                    </div>
                                    <div class="settlement-waste-module">
                                        <p class="settlement-step-label">三、其他费用</p>
                                        <p class="settlement-hint">按每一项选择计入方式（废稿比例按设置页计算）</p>
                                        <div id="settlementOtherFeesByItem" class="settlement-other-fees-by-item"></div>
                                        <p class="settlement-waste-detail-summary settlement-waste-receivable-line">其他费用计入：<span id="settlementOtherFeesAmount">¥0.00</span></p>
                                    </div>
                                </div>
                                <div id="settlementWastePercentTotalWrap" class="settlement-form-block d-none">
                                    <div class="settlement-waste-module">
                                        <p class="settlement-step-label">一、废稿比例</p>
                                        <p class="settlement-waste-detail-summary">预定实收：<span id="settlementPercentTotalBase">¥0.00</span></p>
                                        <p class="settlement-waste-detail-summary">废稿比例：<span id="settlementPercentTotalRatio">30%</span></p>
                                        <p class="settlement-waste-detail-summary settlement-waste-receivable-line">废稿费：<span id="settlementPercentTotalWasteFee">¥0.00</span></p>
                                    </div>
                                    <div class="settlement-waste-module">
                                        <p class="settlement-step-label">二、其他费用</p>
                                        <p class="settlement-hint">按每一项选择计入方式（废稿比例按设置页计算）</p>
                                        <div id="settlementPercentTotalOtherFees" class="settlement-other-fees-by-item"></div>
                                        <p class="settlement-waste-detail-summary settlement-waste-receivable-line">其他费用计入：<span id="settlementPercentTotalOtherAmount">¥0.00</span></p>
                                    </div>
                                </div>
                                <div id="settlementWasteFixedPerItemWrap" class="settlement-form-block d-none">
                                    <div class="settlement-waste-module">
                                        <p class="settlement-step-label">一、参与计费的制品</p>
                                        <p class="settlement-hint">勾选参与计费的制品</p>
                                        <div id="settlementFixedPerItemList" class="settlement-coefficients-included"></div>
                                        <p class="settlement-waste-detail-summary">计费件数：<span id="settlementFixedPerItemCount">0</span> 件</p>
                                    </div>
                                    <div class="settlement-waste-module">
                                        <p class="settlement-step-label">二、按件金额</p>
                                        <p class="settlement-waste-detail-summary">按件金额（元，可修改）<input type="number" id="settlementFixedPerItemPrice" min="0" step="0.01" value="20"></p>
                                        <p class="settlement-waste-detail-summary settlement-waste-receivable-line">废稿费：<span id="settlementFixedPerItemWasteFee">¥0.00</span></p>
                                    </div>
                                    <div class="settlement-waste-module">
                                        <p class="settlement-step-label">三、其他费用</p>
                                        <p class="settlement-hint">按每一项选择计入方式（废稿比例按设置页计算）</p>
                                        <div id="settlementFixedPerItemOtherFees" class="settlement-other-fees-by-item"></div>
                                        <p class="settlement-waste-detail-summary settlement-waste-receivable-line">其他费用计入：<span id="settlementFixedPerItemOtherAmount">¥0.00</span></p>
                                    </div>
                                </div>
                                <div id="settlementWasteFixedAmountWrap" class="settlement-form-block d-none">
                                    <div class="settlement-waste-module">
                                        <p class="settlement-step-label">一、固定金额</p>
                                        <p class="settlement-hint">与订单金额无关</p>
                                        <p class="settlement-waste-detail-summary settlement-waste-receivable-line">废稿费（元，可修改）<input type="number" id="settlementFixedAmountWasteFee" min="0" step="0.01" value="50"></p>
                                    </div>
                                    <div class="settlement-waste-module">
                                        <p class="settlement-step-label">二、其他费用</p>
                                        <p class="settlement-hint">按每一项选择计入方式（废稿比例按设置页计算）</p>
                                        <div id="settlementFixedAmountOtherFees" class="settlement-other-fees-by-item"></div>
                                        <p class="settlement-waste-detail-summary settlement-waste-receivable-line">其他费用计入：<span id="settlementFixedAmountOtherAmount">¥0.00</span></p>
                                    </div>
                                </div>
                                <div class="settlement-preview settlement-waste-final">
                                    <label>废稿费（应收，元）<input type="number" id="settlementWasteFinalAmount" min="0" step="0.01" value="0"></label>
                                </div>
                            </div>
                            <div id="settlementFormNormal" class="settlement-form settlement-form-normal d-none">
                                <div class="settlement-discount-formula">
                                    <span class="settlement-discount-formula-text">实收 = (应收 − 减去金额之和) × 折扣系数乘积</span>
                                </div>
                                <div class="settlement-discount-reasons-block">
                                    <label class="settlement-discount-reasons-label">优惠原因</label>
                                    <div id="settlementDiscountReasonsWrap" class="settlement-discount-reasons-wrap">
                                        <!-- 由 JS 填充 -->
                                    </div>
                                    <div class="settlement-other-reason-row">
                                        <div class="settlement-other-reason-head">
                                            <input type="text" id="settlementDiscountReasonOther" class="settlement-other-input" placeholder="其他原因">
                                            <div id="settlementOtherTypeToggle" class="settlement-reason-type-toggle" data-active="amount"><input type="hidden" id="settlementOtherType" value="amount"><span class="settlement-reason-type-thumb"></span><button type="button" class="settlement-reason-type-btn active" data-value="amount">减去</button><button type="button" class="settlement-reason-type-btn" data-value="rate">折扣</button></div>
                                        </div>
                                        <div class="settlement-other-reason-input">
                                            <span id="settlementOtherAmountWrap"><input type="number" id="settlementOtherAmount" min="0" step="0.01" value="0" class="settlement-reason-input" placeholder="0"></span>
                                            <span id="settlementOtherRateWrap" style="display:none"><input type="number" id="settlementOtherRate" min="0" max="0.99" step="0.01" value="0.99" class="settlement-reason-input" placeholder="0.99"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="settlement-final-amount-block">
                                    <label class="settlement-final-amount-label">本次收款（元）</label>
                                    <input type="number" id="settlementNormalAmount" class="settlement-final-amount-input" min="0" step="0.01" value="0">
                                    <p id="settlementNewPlatformFeeText" class="settlement-hint settlement-platform-fee-hint d-none"></p>
                                    <p id="settlementOwnerPayText" class="settlement-hint settlement-owner-pay-hint">实际单主支付：¥0.00</p>
                                </div>
                            </div>
                        </div>
                        <!-- 结算参考面板（展示计算过程，用于确定已收/已退金额） -->
                        <div id="settlementPreviewPanel" class="settlement-preview-panel d-none">
                            <div class="settlement-preview-title">结算参考（计算过程）</div>
                            <p class="settlement-preview-hint">以下为计算过程，用于确定收费与退款；已收多少、已退多少请在此处填写或核对，确认后小票将展示结算结果。</p>
                            <div id="settlementPreviewContent" class="settlement-preview-content"></div>
                        </div>
                    </div>
                    <div class="settlement-modal-footer">
                        <button type="button" id="settlementBtnBack" class="btn secondary d-none" onclick="settlementStepBack()">上一步</button>
                        <button type="button" id="settlementBtnNext" class="btn primary" onclick="settlementStepNext()">下一步</button>
                        <button type="button" id="settlementBtnConfirm" class="btn primary d-none" onclick="settlementConfirm()">确认</button>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- 全局轻提示（toast），用于非阻塞提示“排单已更新”等信息 -->
    <!-- 订单备注查看弹窗（只读） -->
    <div id="orderRemarkViewModal" class="modal d-none">
        <div class="modal-content modal-content-compact">
            <div class="modal-header">
                <h3>订单备注</h3>
                <span class="close" onclick="closeOrderRemarkViewModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="orderRemarkViewContent" class="order-remark-view-content"></div>
            </div>
        </div>
    </div>
    <!-- 订单备注弹窗（全局，编辑用） -->
    <div id="orderRemarkModal" class="modal d-none">
        <div class="modal-content modal-content-compact">
            <div class="modal-header">
                <h3>订单备注</h3>
                <span class="close" onclick="closeOrderRemarkModal()">&times;</span>
            </div>
            <div class="modal-body">
                <p class="order-remark-hint text-gray">输入或粘贴单主发的备注后，点击下方<strong>「智能提取」</strong>，可自动识别制品与赠品并填入报价表。</p>
                <textarea id="orderRemarkText" rows="10" placeholder="粘贴订单备注，再点下方「智能提取」自动识别&#10;&#10;示例：&#10;拍立得 单面 2个&#10;吧唧 10个 双面 带背景&#10;赠品：头像 3个"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-compact primary" onclick="smartParseOrderRemark()" title="根据备注内容自动识别制品、赠品并填入计算表">智能提取</button>
                <button type="button" class="btn btn-compact secondary" onclick="copyOrderRemark()">复制</button>
                <button type="button" class="btn btn-compact" onclick="closeOrderRemarkModal()">确定</button>
            </div>
        </div>
    </div>

    <!-- 单主ID 确认填充弹窗：输入关键词后列出匹配的单主ID，选择一项后再填充 -->
    <div id="clientIdConfirmModal" class="history-record-modal d-none" aria-hidden="true">
        <div class="history-record-overlay" onclick="closeClientIdConfirmModal()"></div>
        <div class="history-record-content record-import-mode-content">
            <div class="history-record-header">
                <h2>选择单主ID</h2>
                <button type="button" class="btn-icon btn--icon btn-close-flat" onclick="closeClientIdConfirmModal()" aria-label="关闭" title="关闭">
                    <svg class="icon" aria-hidden="true"><use href="#i-close"></use></svg>
                    <span class="sr-only">关闭</span>
                </button>
            </div>
            <div class="history-record-body">
                <p class="text-gray mb-2" style="font-size:0.9rem;">根据输入的关键词匹配到以下记录，点击一项填充单主ID、接单平台与联系方式。</p>
                <div id="clientIdConfirmList" class="d-flex flex-col gap-1"></div>
                <button type="button" class="btn secondary w-full mt-2" onclick="closeClientIdConfirmModal()">取消</button>
            </div>
        </div>
    </div>

    <!-- 计算页保存方式选择弹窗（编辑模式下点「保存」时弹出） -->
    <div id="calculatorSaveChoiceModal" class="history-record-modal d-none" aria-hidden="true">
        <div class="history-record-overlay" onclick="closeCalculatorSaveChoiceModal()"></div>
        <div class="history-record-content record-import-mode-content">
            <div class="history-record-header">
                <h2>保存方式</h2>
                <button type="button" class="btn-icon btn--icon btn-close-flat" onclick="closeCalculatorSaveChoiceModal()" aria-label="关闭" title="关闭">
                    <svg class="icon" aria-hidden="true"><use href="#i-close"></use></svg>
                    <span class="sr-only">关闭</span>
                </button>
            </div>
            <div class="history-record-body">
                <p class="mb-2">请选择如何保存当前报价：</p>
                <div class="d-flex flex-col gap-2">
                    <button type="button" class="btn secondary w-full" onclick="calculatorSaveChoiceOverwrite()">覆盖原订单</button>
                    <button type="button" class="btn w-full" onclick="calculatorSaveChoiceSaveAsNew()">另存为新排单</button>
                    <button type="button" class="btn secondary w-full" onclick="closeCalculatorSaveChoiceModal()">取消</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 小票页排单保存方式选择弹窗（编辑模式下点「排单」时弹出） -->
    <div id="receiptScheduleChoiceModal" class="history-record-modal d-none" aria-hidden="true">
        <div class="history-record-overlay" onclick="closeReceiptScheduleChoiceModal()"></div>
        <div class="history-record-content record-import-mode-content">
            <div class="history-record-header">
                <h2>保存方式</h2>
                <button type="button" class="btn-icon btn--icon btn-close-flat" onclick="closeReceiptScheduleChoiceModal()" aria-label="关闭" title="关闭">
                    <svg class="icon" aria-hidden="true"><use href="#i-close"></use></svg>
                    <span class="sr-only">关闭</span>
                </button>
            </div>
            <div class="history-record-body">
                <p class="mb-2">请选择如何保存当前小票：</p>
                <div class="d-flex flex-col gap-2">
                    <button type="button" class="btn secondary w-full" onclick="receiptScheduleChoiceOverwrite()">覆盖原订单</button>
                    <button type="button" class="btn w-full" onclick="receiptScheduleChoiceSaveAsNew()">另存为新排单</button>
                    <button type="button" class="btn secondary w-full" onclick="closeReceiptScheduleChoiceModal()">取消</button>
                </div>
            </div>
        </div>
    </div>

    <div id="globalToast" class="global-toast d-none"></div>

    <script src="script.js?v=20250204-deposit-display"></script>
</body>
</html>
