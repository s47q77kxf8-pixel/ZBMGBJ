# MG 报价工具（专属报价计算器）

美工/画师用的制品报价单生成工具，支持多种计价方式、系数与工艺，报价结果以「收银小票」形式展示，可导出图片与历史记录。

---

## 功能概览

- **计算页**：单主信息、用途/加急/折扣/平台费等系数、制品与赠品、工艺与同模，一键计算总价；支持模板管理（保存/加载常用制品组合）
- **报价页**：小票样式报价单、小票自定义（头图/标题/订单说明/尾图）、保存为图片、历史记录管理
- **设置页**：制品类型与三种计价方式、用途/加急/同模/折扣/平台费等系数、工艺及每层价、其他费用、支持 Excel 批量导入
- **历史记录**：筛选、排序、分组显示、批量删除、Excel导出（含制品明细）

### 制品计价方式

| 方式 | 说明 |
|------|------|
| 固定价 | 单一单价，如普通吧唧 70 元/件 |
| 单双面价 | 单面/双面分别定价，如拍立得单面 80、双面 120 |
| 基础+递增价 | 基础配置价 + 每增加单位的价格，如立牌 130 + 每插 30、麻将 110 + 每层 30 |

### 价格计算逻辑

```
单件制品价 = 基础价 × (1 + 同模系数×(柄图数−1)) + 工艺费用×工艺层数
总价 = Σ(各制品价) × 加价类系数连乘 × 折扣类系数连乘 + 其他费用合计 + 平台手续费
```

---

## 快速开始

- 用浏览器直接打开根目录下的 `index.html` 即可使用，无需构建或服务器。
- 依赖通过 CDN 引入：**html2canvas**（导出图片）、**xlsx**（Excel 导入），需联网加载。

本地预览示例：

```bash
# 若已安装 Python
python -m http.server 8080
# 浏览器访问 http://localhost:8080
```

---

## 技术说明

- 纯前端：HTML + CSS + JavaScript，无后端
- 数据与设置保存在浏览器本地（localStorage），清空浏览器数据会丢失
- 推荐使用 Chrome、Edge、Firefox、Safari 等现代浏览器；支持响应式，可在手机端使用

---

## 项目结构

```
MGbaojia/
├── index.html          # 主页面（计算页 / 报价页 / 设置页）
├── script.js           # 业务逻辑、计价、小票生成、历史与设置存取
├── style.css           # 全局与小票样式
├── README.md           # 本说明

```

---

## 使用说明

### 一、计算页

1. **单主信息**：单主 ID、联系方式（QQ/微信/米画师等）、开始时间、截稿时间。
2. **设置选项**：用途、加急、同模系数、折扣系数、平台手续费；另有「其他加价/折扣类」可扩展。
   - **模版填表**：点击设置选项标题右侧的「模版填表」按钮，可加载已保存的模板或删除模板。
3. **其他费用**：抠图费等从预设选择或自定义名称与金额。
4. **制品 / 赠品**：选择制品类型、单双面（若适用）、数量、同模、工艺类型与层数；赠品规则同制品，展示时区分「赠品」并可按设置显示划线原价与优惠价。
5. **模板管理**：在页面底部可保存当前制品和赠品组合为模板（包含设置选项），下次使用时一键加载。
6. 点击 **「计算报价」**（悬浮按钮）生成报价单并跳转报价页。

### 二、报价页

- 以**小票样式**展示：制品列表（总览行与明细行）、工艺与同模、制品小计、加价合计、折扣合计、其他费用、总金额、平台费、实付金额等。
- **小票设置**：头部图片、标题、订单说明、是否显示开始/截稿时间与设计师信息、尾部文本与图片。
- **保存图片**：将当前小票区域导出为图片（移动端支持保存到相册）。
- **保存历史**：把当前报价写入本地历史，便于日后查看或重新加载。
- **历史记录管理**：
  - **搜索**：关键词搜索历史记录
  - **筛选**（移动端抽屉式）：时间范围、价格范围、排序方式、显示方式（列表/按月分组）
  - **批量操作**：全选、批量删除
  - **编辑**：点击「编辑」按钮可将历史记录加载到计算页进行修改
  - **查看详情**：查看完整报价单
  - **导出Excel**：导出历史记录汇总和制品明细（两个工作表）

### 三、设置页

- **美工信息**：美工 ID、联系方式、默认工期。
- **制品设置**：按分类管理制品，每种制品选择「固定价 / 单双面价 / 基础+递增价」并填写对应价格与单位；支持 Excel 批量导入。
- **系数设置**：用途系数、加急系数、同模系数、折扣系数、平台手续费；加价类、折扣类可在界面中增删选项。
- **工艺设置**：工艺名称与每层单价（如烫色、白墨、UV、逆向等）。
- **其他费用**：预设或自定义费用类别与默认金额。
- 修改后点击 **「保存设置」**；可 **「恢复默认设置」**。

### 四、小票展示规则概要

- 总览行：无同模无工艺时显示单价×数量=小计；有同模或工艺时单价列显示「—」。
- 明细行：全价制品、同模制品、工艺等按「单价×数量=小计」可自证的方式展示；工艺按「每层单价」分组，同单价可合并为一行。
- 详细约定见 **《小票制品展示规范》**；分割线与样式见 **《小票边框线说明》**。

---

## 注意事项

1. **数据存储**：数据与历史均存于浏览器本地（localStorage），更换设备或清空数据会丢失，重要报价建议及时「保存图片」或另行备份。
2. **模板保存**：模板会保存制品、赠品和设置选项（用途、加急、折扣等），方便快速复用常用配置。
3. **历史记录**：历史记录最多保存 20 条，超出会自动删除最旧的记录。
4. **打印或导出**：打印或导出时，可调整边距以使小票完整显示。
5. **系数设置**：系数、工艺、其他费用等以设置页中当前配置为准，计算页与历史记录会按保存时的设置解释与展示。
6. **移动端优化**：历史记录筛选在移动端采用抽屉式设计，点击「筛选」按钮打开；桌面端同样支持抽屉式筛选。

---

## 更新日志

### 最新版本

- ✨ **模板管理功能**：支持保存/加载制品和赠品组合，包含设置选项
- ✨ **历史记录编辑**：可从历史记录加载到计算页进行修改
- ✨ **历史记录筛选优化**：移动端抽屉式设计，支持时间、价格、排序、分组筛选
- ✨ **批量操作**：支持全选、批量删除历史记录
- ✨ **Excel导出增强**：导出时包含制品详细信息（两个工作表：汇总表和明细表）
- 🐛 **修复**：修复模板保存后刷新页面丢失的问题
- 🐛 **修复**：修复历史记录筛选功能在移动端的显示问题
